import{d as ue,s as be,a as n,t as p,c as re,b as q,e as xe,f as ie}from"../chunks/disclose-version.BtOGdF5q.js";import{I as ye,L as ze,M as l,N as t,K as x,J as F,O as r,d as e,C as ke,P as Me,D as Q}from"../chunks/utils.Dv3gV-s9.js";import{c as H,a as se,r as De,e as ae,b as qe,d as W,i as Se,s as ve,f as le}from"../chunks/operation.BKWR8LM7.js";import{i as L}from"../chunks/if.DdkDn34N.js";import{m as Y,e as ce,g as U,t as pe,s as oe}from"../chunks/modalStore.BHz7SopB.js";import{o as $e}from"../chunks/index-client.MCpA-LfM.js";import{g as Ae}from"../chunks/entry.SRtn1Uy3.js";import{S as Ee,R as Te}from"../chunks/Source.vaGKTMWg.js";import{g as Z}from"../chunks/index.DD94zoj9.js";const He=({url:A})=>{const f=A.searchParams.get("date");return console.log(f),{date:f}},pt=Object.freeze(Object.defineProperty({__proto__:null,load:He},Symbol.toStringTag,{value:"Module"}));var Ie=()=>ce.showInfo("工位不可用"),Be=p('<button class="tooltip-container unavailable-cell svelte-plcc5o"><span>工位不可用</span> <svg class="logo svelte-plcc5o" style="fill: #fbc400;opacity:0.8" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M821.344 458.656v106.688H202.656v-106.688h618.688zM1024 512c0 282.784-229.216 512-512 512S0 794.784 0 512 229.216 0 512 0s512 229.216 512 512z m-85.344 0c0-235.264-191.392-426.656-426.656-426.656S85.344 276.736 85.344 512 276.736 938.656 512 938.656 938.656 747.264 938.656 512z" class="svelte-plcc5o"></path></svg> <span style="font-size: 0.8rem;margin-top:0.5rem" class="first-letter-capital svelte-plcc5o"> </span></button>'),Ce=p('<div style="font-size: smaller; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;" class="svelte-plcc5o"> </div>'),Le=p('<div style="font-size: smaller; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;" class="svelte-plcc5o"> </div>'),Pe=p('<div style="font-size: smaller; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;" class="svelte-plcc5o"> </div>'),Re=p('<div class="divider svelte-plcc5o"></div> <!> <!> <!>',1),je=p('<button style="gap: 5px; display: flex; flex-direction: column; align-items: center; width: 100%;" class="tooltip-container svelte-plcc5o"><span>点击查看预约</span> <div class="engineer-info svelte-plcc5o" style="display: flex; flex-direction: column; gap: 0.25rem; font-size: 0.75rem;"><div class="engineer-item svelte-plcc5o" style="display: flex; align-items: center; gap: 0.25rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"><span class="badge svelte-plcc5o" style="background-color: #e2e8f0; color: #475569; padding: 0.125rem 0.25rem; border-radius: 0.25rem; font-size: 0.7rem; font-weight: 600; flex-shrink: 0;">PE</span> <span class="name svelte-plcc5o" style="color: #1e293b; overflow: hidden; text-overflow: ellipsis;"> </span></div> <div class="engineer-item svelte-plcc5o" style="display: flex; align-items: center; gap: 0.25rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"><span class="badge svelte-plcc5o" style="background-color: #e2e8f0; color: #475569; padding: 0.125rem 0.25rem; border-radius: 0.25rem; font-size: 0.7rem; font-weight: 600; flex-shrink: 0;">TE</span> <span class="name svelte-plcc5o" style="color: #1e293b; overflow: hidden; text-overflow: ellipsis;"> </span></div></div> <!></button>'),Ne=p('<button class="tooltip-container coffee-btn svelte-plcc5o" aria-label="open_new"><span>无预约</span> <svg class="logo spare svelte-plcc5o" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M797.994667 448.725333v123.306667a243.626667 243.626667 0 0 1-243.626667 243.669333H371.626667A243.626667 243.626667 0 0 1 128 572.074667V358.826667c0-16.810667 13.653333-30.421333 30.464-30.421334h119.381333C292.096 319.146667 298.666667 305.408 298.666667 285.184c0-13.098667-6.058667-23.253333-25.344-44.928l-3.541334-4.010667c-23.125333-26.112-32.725333-42.538667-32.554666-67.114666 0.256-37.333333 15.658667-65.536 45.482666-81.322667a21.333333 21.333333 0 0 1 19.968 37.717333c-15.232 8.064-22.613333 21.589333-22.784 43.946667-0.085333 10.581333 5.376 19.925333 21.845334 38.485333l3.498666 3.968c25.984 29.226667 36.096 46.08 36.096 73.258667 0 16.128-2.986667 30.634667-8.874666 43.264h116.010666c14.250667-9.301333 20.864-23.04 20.864-43.264 0-13.098667-6.058667-23.253333-25.344-44.928l-3.541333-4.010667c-23.125333-26.112-32.725333-42.538667-32.554667-67.114666 0.256-37.333333 15.658667-65.536 45.482667-81.322667a21.333333 21.333333 0 1 1 19.968 37.717333c-15.232 8.064-22.613333 21.589333-22.784 43.946667-0.085333 10.581333 5.376 19.925333 21.845333 38.485333l3.498667 3.968c25.984 29.226667 36.096 46.08 36.096 73.258667 0 16.128-2.986667 30.634667-8.874667 43.264h93.696c16.853333 0 30.464 13.610667 30.464 30.421333v46.976A149.333333 149.333333 0 1 1 810.666667 704a21.333333 21.333333 0 1 1 0-42.666667 106.666667 106.666667 0 1 0-12.672-212.608zM213.333333 917.333333a21.333333 21.333333 0 1 1 0-42.666666h512a21.333333 21.333333 0 1 1 0 42.666666H213.333333z" class="svelte-plcc5o"></path></svg></button>'),Oe=p('<div class="svelte-plcc5o">Loading...</div>'),Ue=p('<td class="fixed-width svelte-plcc5o" style="text-align:left;font-size:12px;"><!></td>'),Ke=()=>Ae("/"),Ve=(A,f,S,K)=>{H.previous(),f(S())},Ge=(A,f,S,K)=>{var u;H.setDate((u=A.target)==null?void 0:u.value),f(S())},Je=(A,f,S,K)=>{H.next(),f(S())},Xe=p('<th class="fixed-width tooltip-container svelte-plcc5o"><span class="tooltip svelte-plcc5o">点击查看工位详情</span> <a class="link svelte-plcc5o"> </a></th>'),Fe=p('<tr class="svelte-plcc5o"><td class="sticky-column svelte-plcc5o"> </td><!></tr>'),Qe=p('<table class="svelte-plcc5o"><thead class="svelte-plcc5o"><tr class="svelte-plcc5o"><th class="sticky-column svelte-plcc5o">时间</th><!></tr></thead><tbody class="svelte-plcc5o"></tbody></table>'),We=p('<div class="svelte-plcc5o">Loading...</div>'),Ye=p('<div class="fixed-header svelte-plcc5o"><button aria-label="calendar_view" class="tooltip-container svelte-plcc5o"><span class="tooltip svelte-plcc5o">返回月度视图</span> <svg class="logo svelte-plcc5o" style="fill: #fbc400;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M109.714286 950.857143l164.571429 0 0-164.571429-164.571429 0 0 164.571429zM310.857143 950.857143l182.857143 0 0-164.571429-182.857143 0 0 164.571429zM109.714286 749.714286l164.571429 0 0-182.857143-164.571429 0 0 182.857143zM310.857143 749.714286l182.857143 0 0-182.857143-182.857143 0 0 182.857143zM109.714286 530.285714l164.571429 0 0-164.571429-164.571429 0 0 164.571429zM530.285714 950.857143l182.857143 0 0-164.571429-182.857143 0 0 164.571429zM310.857143 530.285714l182.857143 0 0-164.571429-182.857143 0 0 164.571429zM749.714286 950.857143l164.571429 0 0-164.571429-164.571429 0 0 164.571429zM530.285714 749.714286l182.857143 0 0-182.857143-182.857143 0 0 182.857143zM329.142857 256l0-164.571429q0-7.460571-5.412571-12.873143t-12.873143-5.412571l-36.571429 0q-7.460571 0-12.873143 5.412571t-5.412571 12.873143l0 164.571429q0 7.460571 5.412571 12.873143t12.873143 5.412571l36.571429 0q7.460571 0 12.873143-5.412571t5.412571-12.873143zM749.714286 749.714286l164.571429 0 0-182.857143-164.571429 0 0 182.857143zM530.285714 530.285714l182.857143 0 0-164.571429-182.857143 0 0 164.571429zM749.714286 530.285714l164.571429 0 0-164.571429-164.571429 0 0 164.571429zM768 256l0-164.571429q0-7.460571-5.412571-12.873143t-12.873143-5.412571l-36.571429 0q-7.460571 0-12.873143 5.412571t-5.412571 12.873143l0 164.571429q0 7.460571 5.412571 12.873143t12.873143 5.412571l36.571429 0q7.460571 0 12.873143-5.412571t5.412571-12.873143zM987.428571 219.428571l0 731.428571q0 29.696-21.723429 51.419429t-51.419429 21.723429l-804.571429 0q-29.696 0-51.419429-21.723429t-21.723429-51.419429l0-731.428571q0-29.696 21.723429-51.419429t51.419429-21.723429l73.142857 0 0-54.857143q0-37.741714 26.843429-64.585143t64.585143-26.843429l36.571429 0q37.741714 0 64.585143 26.843429t26.843429 64.585143l0 54.857143 219.428571 0 0-54.857143q0-37.741714 26.843429-64.585143t64.585143-26.843429l36.571429 0q37.741714 0 64.585143 26.843429t26.843429 64.585143l0 54.857143 73.142857 0q29.696 0 51.419429 21.723429t21.723429 51.419429z" class="svelte-plcc5o"></path></svg></button> <div class="month-nav svelte-plcc5o"><button class="tooltip-container svelte-plcc5o" aria-label="previous_month"><span class="tooltip svelte-plcc5o">上一天</span> <svg class="logo svelte-plcc5o" style="fill: #fbc400;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M629.291 840.832l60.331-60.331-268.501-268.501 268.501-268.501-60.331-60.331-328.832 328.832z" class="svelte-plcc5o"></path></svg></button> <input type="date" class="date-input svelte-plcc5o"> <button class="tooltip-container svelte-plcc5o" aria-label="next_month"><span class="tooltip svelte-plcc5o">下一天</span> <svg class="logo svelte-plcc5o" style="fill: #fbc400;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M689.621 512l-328.832-328.832-60.331 60.331 268.501 268.501-268.501 268.501 60.331 60.331z" class="svelte-plcc5o"></path></svg></button></div> <button class="tooltip-container svelte-plcc5o" aria-label="about"><span class="tooltip svelte-plcc5o">数据源设置</span> <svg class="logo svelte-plcc5o" style="width: 30px;height: 30px" fill="#fbc400" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M369.777778 455.111111h284.444444c17.066667 0 28.444444 11.377778 28.444445 28.444445s-11.377778 28.444444-28.444445 28.444444h-284.444444c-17.066667 0-28.444444-11.377778-28.444445-28.444444s11.377778-28.444444 28.444445-28.444445z" class="svelte-plcc5o"></path><path d="M56.888889 483.555556C56.888889 625.777778 170.666667 739.555556 312.888889 739.555556H398.222222v-56.888889H312.888889C204.8 682.666667 113.777778 591.644444 113.777778 483.555556S204.8 284.444444 312.888889 284.444444H398.222222V227.555556H312.888889C170.666667 227.555556 56.888889 341.333333 56.888889 483.555556zM711.111111 227.555556H625.777778v56.888888h85.333333C819.2 284.444444 910.222222 375.466667 910.222222 483.555556S819.2 682.666667 711.111111 682.666667H625.777778v56.888889h85.333333C853.333333 739.555556 967.111111 625.777778 967.111111 483.555556S853.333333 227.555556 711.111111 227.555556z" class="svelte-plcc5o"></path></svg></button></div> <div class="table-container svelte-plcc5o"><div class="table-wrapper svelte-plcc5o"><!></div></div>',1),Ze=p('<div class="svelte-plcc5o"> </div>'),et=p('<div class="loading-container svelte-plcc5o"><div class="loading-spinner-wrapper svelte-plcc5o"><div class="loading-spinner svelte-plcc5o"></div></div> <span class="loading-text svelte-plcc5o">加载中...</span></div>'),tt=p('<main class="container svelte-plcc5o"><!></main>');function dt(A,f){ye(f,!0);const S=be(),K=()=>re(Y,"$modalStore",S),u=()=>re(e(k),"$selectedDate",S),de=(s,a=Q,o=Q,d=Q,_=Q)=>{var i=Ue(),g=l(i);L(g,()=>o().status!=="in_service",v=>{var h=Be();h.__click=[Ie];var B=l(h),w=r(B,4),c=l(w,!0);x(()=>q(c,o().status.replaceAll("_"," "))),t(w),t(h),x(()=>oe(B,`${`${a()==="T5"?"tooltip-top":"tooltip"}`??""} svelte-plcc5o`)),n(v,h)},v=>{var h=ie(),B=F(h);se(B,()=>Promise.resolve(d().filter(w=>w.time_slot===a()&&w.station_id===o().id)[0]),w=>{var c=Oe();n(w,c)},(w,c)=>{var V=ie(),E=F(V);L(E,()=>e(c),y=>{var m=je();m.__click=()=>{Y.open(Te,{reservation:e(c)})};var $=l(m),C=r($,2),P=l(C),R=r(l(P),2),j=l(R,!0);t(R),t(P);var M=r(P,2),D=r(l(M),2),z=l(D,!0);t(D),t(M),t(C);var T=r(C,2);L(T,()=>e(c).job_no||e(c).product_name||e(c).client_name,te=>{var G=Re(),J=r(F(G),2);L(J,()=>e(c).job_no,N=>{var b=Ce(),O=l(b,!0);t(b),x(()=>q(O,e(c).job_no)),n(N,b)});var X=r(J,2);L(X,()=>e(c).product_name,N=>{var b=Le(),O=l(b,!0);t(b),x(()=>q(O,e(c).product_name)),n(N,b)});var fe=r(X,2);L(fe,()=>e(c).client_name,N=>{var b=Pe(),O=l(b,!0);t(b),x(()=>q(O,e(c).client_name)),n(N,b)}),n(te,G)}),t(m),x(()=>{oe($,`${(a()==="T5"?"tooltip-top":"tooltip")??""} svelte-plcc5o`),q(j,e(c).project_engineer),q(z,e(c).testing_engineer)}),n(y,m)},y=>{var m=Ne(),$=l(m);Me(2),t(m),x(()=>oe($,`${(a()==="T5"?"tooltip-top":"tooltip")??""} svelte-plcc5o`)),n(y,m)}),n(w,V)}),n(v,h)}),t(i),x(()=>pe(i,"station-unavailable",o().status!=="in_service")),n(s,i)},_e=f.data.date??new Date().toISOString().split("T")[0];H.setDate(_e);const k=ke(()=>H.selectedDate);async function ge(){let s=[];try{const a=await W.getAllStations(),o=await W.getAllSevents();console.log(a);const d=U("station_orders");return console.log(d),d&&d.length>0&&a.length>0?s=[...a.map(i=>{const g=d.find(v=>v.id===i.id);return{...i,sequence_no:(g==null?void 0:g.seq)??1}})].sort((i,g)=>i.sequence_no-g.sequence_no):s=[...a],s=s.map(_=>{const i=o.filter(g=>g.station_id===_.id);if(i.length===0)return{..._,status:"in_service"};if(i.some(v=>new Date(Z(e(k)))>=new Date(v.from_date)&&new Date(Z(e(k)))<=new Date(v.to_date))){const v=i.find(h=>new Date(Z(e(k)))>=new Date(h.from_date)&&new Date(Z(e(k)))<=new Date(h.to_date));return{..._,status:(v==null?void 0:v.name)??"unavailable"}}else return{..._,status:"in_service"}}),s}catch(a){return ce.handleError(a),[]}}async function I(s){let a=[];try{return a=await W.getReservationsByDate(s),a}catch(o){return ce.handleError(o),[]}}const he=async(s,a)=>{const o=await ge();console.log(o);const d=await I(s),_=await W.getAllSevents();return{stations:o,res:d,sevents:_}},we=async()=>{const s=U("user"),a=U("tests"),o=U("project_engineers"),d=U("testing_engineers");(!s||!a||!o||!d)&&await Se(),await new Promise(_=>setTimeout(_,100))},ne=s=>{if(K().show){const a=s.target;!(a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable)&&(s.key==="ArrowLeft"||s.key==="ArrowRight")&&s.preventDefault();return}s.key==="ArrowLeft"?(H.previous(),I(u())):s.key==="ArrowRight"&&(H.next(),I(u()))};$e(()=>(window.addEventListener("keydown",ne),()=>window.removeEventListener("keydown",ne)));var ee=tt(),me=l(ee);se(me,we,s=>{var a=et();n(s,a)},(s,a)=>{var o=Ye(),d=F(o),_=l(d);_.__click=[Ke];var i=r(_,2),g=l(i);g.__click=[Ve,I,u,k];var v=r(g,2);De(v),v.__change=[Ge,I,u,k];var h=r(v,2);h.__click=[Je,I,u,k],t(i);var B=r(i,2);B.__click=()=>Y.open(Ee,{onNegative:()=>Y.close()}),t(d);var w=r(d,2),c=l(w),V=l(c);se(V,()=>he(u()),E=>{var y=We();n(E,y)},(E,y)=>{var m=Qe(),$=l(m),C=l($),P=r(l(C));ae(P,17,()=>e(y).stations,le,(j,M)=>{var D=Xe(),z=r(l(D),2),T=l(z,!0);t(z),t(D),x(()=>{pe(D,"station-unavailable",e(M).status!=="in_service"),ve(z,"title",e(M).name),ve(z,"href",`/station?stationId=${e(M).id}&date=${u()}`),q(T,e(M).short_name)}),n(j,D)}),t(C),t($);var R=r($);ae(R,20,()=>["9:30-12:00","13:00-15:00","15:00-17:30","18:00-20:30","20:30-23:59"],le,(j,M,D)=>{var z=Fe(),T=l(z),te=l(T,!0);t(T);var G=r(T);ae(G,17,()=>e(y).stations,le,(J,X)=>{de(J,()=>`T${D+1}`,()=>e(X),()=>e(y).res,()=>e(y).sevents)}),t(z),x(()=>q(te,M)),n(j,z)}),t(R),t(m),n(E,m)}),t(c),t(w),qe(v,u,E=>xe(e(k),E)),n(s,o)},(s,a)=>{var o=Ze(),d=l(o,!0);t(o),x(()=>q(d,"Error: "+e(a).message)),n(s,o)}),t(ee),n(A,ee),ze()}ue(["click","change"]);export{dt as component,pt as universal};
