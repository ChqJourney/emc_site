import{d as xe,s as ye,a as c,t as d,c as ie,b as S,e as ze,f as ve}from"../chunks/disclose-version.BtOGdF5q.js";import{I as ke,L as Me,M as l,N as a,K as x,J as F,O as i,d as e,C as De,P as Se,D as Q}from"../chunks/utils.Dv3gV-s9.js";import{c as I,a as ae,r as qe,e as le,b as $e,d as W,i as Ae,s as pe,f as oe}from"../chunks/operation.Bbmgri_J.js";import{i as P}from"../chunks/if.DdkDn34N.js";import{m as Y,g as A,e as ce,t as de,s as ne}from"../chunks/modalStore.dvlA8jbC.js";import{o as Ee}from"../chunks/index-client.MCpA-LfM.js";import{g as Te}from"../chunks/entry.CoaMbvJu.js";import{S as He,R as Ie}from"../chunks/Source.Bzon2jpa.js";import{g as Z}from"../chunks/index.DD94zoj9.js";import{a as ee}from"../chunks/apiService.DgwLLXM9.js";const Be=({url:E})=>{const u=E.searchParams.get("date");return console.log(u),{date:u}},gt=Object.freeze(Object.defineProperty({__proto__:null,load:Be},Symbol.toStringTag,{value:"Module"}));var Ce=()=>ce.showInfo("工位不可用"),Le=d('<button class="tooltip-container unavailable-cell svelte-plcc5o"><span>工位不可用</span> <svg class="logo svelte-plcc5o" style="fill: #fbc400;opacity:0.8" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M821.344 458.656v106.688H202.656v-106.688h618.688zM1024 512c0 282.784-229.216 512-512 512S0 794.784 0 512 229.216 0 512 0s512 229.216 512 512z m-85.344 0c0-235.264-191.392-426.656-426.656-426.656S85.344 276.736 85.344 512 276.736 938.656 512 938.656 938.656 747.264 938.656 512z" class="svelte-plcc5o"></path></svg> <span style="font-size: 0.8rem;margin-top:0.5rem" class="first-letter-capital svelte-plcc5o"> </span></button>'),Pe=d('<div style="font-size: smaller; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;" class="svelte-plcc5o"> </div>'),Re=d('<div style="font-size: smaller; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;" class="svelte-plcc5o"> </div>'),je=d('<div style="font-size: smaller; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;" class="svelte-plcc5o"> </div>'),Ne=d('<div class="divider svelte-plcc5o"></div> <!> <!> <!>',1),Oe=d('<button style="gap: 5px; display: flex; flex-direction: column; align-items: center; width: 100%;" class="tooltip-container svelte-plcc5o"><span>点击查看预约</span> <div class="engineer-info svelte-plcc5o" style="display: flex; flex-direction: column; gap: 0.25rem; font-size: 0.75rem;"><div class="engineer-item svelte-plcc5o" style="display: flex; align-items: center; gap: 0.25rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"><span class="badge svelte-plcc5o" style="background-color: #e2e8f0; color: #475569; padding: 0.125rem 0.25rem; border-radius: 0.25rem; font-size: 0.7rem; font-weight: 600; flex-shrink: 0;">PE</span> <span class="name svelte-plcc5o" style="color: #1e293b; overflow: hidden; text-overflow: ellipsis;"> </span></div> <div class="engineer-item svelte-plcc5o" style="display: flex; align-items: center; gap: 0.25rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"><span class="badge svelte-plcc5o" style="background-color: #e2e8f0; color: #475569; padding: 0.125rem 0.25rem; border-radius: 0.25rem; font-size: 0.7rem; font-weight: 600; flex-shrink: 0;">TE</span> <span class="name svelte-plcc5o" style="color: #1e293b; overflow: hidden; text-overflow: ellipsis;"> </span></div></div> <!></button>'),Ue=d('<button class="tooltip-container coffee-btn svelte-plcc5o" aria-label="open_new"><span>无预约</span> <svg class="logo spare svelte-plcc5o" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M797.994667 448.725333v123.306667a243.626667 243.626667 0 0 1-243.626667 243.669333H371.626667A243.626667 243.626667 0 0 1 128 572.074667V358.826667c0-16.810667 13.653333-30.421333 30.464-30.421334h119.381333C292.096 319.146667 298.666667 305.408 298.666667 285.184c0-13.098667-6.058667-23.253333-25.344-44.928l-3.541334-4.010667c-23.125333-26.112-32.725333-42.538667-32.554666-67.114666 0.256-37.333333 15.658667-65.536 45.482666-81.322667a21.333333 21.333333 0 0 1 19.968 37.717333c-15.232 8.064-22.613333 21.589333-22.784 43.946667-0.085333 10.581333 5.376 19.925333 21.845334 38.485333l3.498666 3.968c25.984 29.226667 36.096 46.08 36.096 73.258667 0 16.128-2.986667 30.634667-8.874666 43.264h116.010666c14.250667-9.301333 20.864-23.04 20.864-43.264 0-13.098667-6.058667-23.253333-25.344-44.928l-3.541333-4.010667c-23.125333-26.112-32.725333-42.538667-32.554667-67.114666 0.256-37.333333 15.658667-65.536 45.482667-81.322667a21.333333 21.333333 0 1 1 19.968 37.717333c-15.232 8.064-22.613333 21.589333-22.784 43.946667-0.085333 10.581333 5.376 19.925333 21.845333 38.485333l3.498667 3.968c25.984 29.226667 36.096 46.08 36.096 73.258667 0 16.128-2.986667 30.634667-8.874667 43.264h93.696c16.853333 0 30.464 13.610667 30.464 30.421333v46.976A149.333333 149.333333 0 1 1 810.666667 704a21.333333 21.333333 0 1 1 0-42.666667 106.666667 106.666667 0 1 0-12.672-212.608zM213.333333 917.333333a21.333333 21.333333 0 1 1 0-42.666666h512a21.333333 21.333333 0 1 1 0 42.666666H213.333333z" class="svelte-plcc5o"></path></svg></button>'),Ke=d('<div class="svelte-plcc5o">Loading...</div>'),Ve=d('<td class="fixed-width svelte-plcc5o" style="text-align:left;font-size:12px;"><!></td>'),Ge=()=>Te("/"),Je=(E,u,q,K)=>{I.previous(),u(q())},Xe=(E,u,q,K)=>{var f;I.setDate((f=E.target)==null?void 0:f.value),u(q())},Fe=(E,u,q,K)=>{I.next(),u(q())},Qe=d('<th class="fixed-width tooltip-container svelte-plcc5o"><span class="tooltip svelte-plcc5o">点击查看工位详情</span> <a class="link svelte-plcc5o"> </a></th>'),We=d('<tr class="svelte-plcc5o"><td class="sticky-column svelte-plcc5o"> </td><!></tr>'),Ye=d('<table class="svelte-plcc5o"><thead class="svelte-plcc5o"><tr class="svelte-plcc5o"><th class="sticky-column svelte-plcc5o">时间</th><!></tr></thead><tbody class="svelte-plcc5o"></tbody></table>'),Ze=d('<div class="svelte-plcc5o">Loading...</div>'),et=d('<div class="fixed-header svelte-plcc5o"><button aria-label="calendar_view" class="tooltip-container svelte-plcc5o"><span class="tooltip svelte-plcc5o">返回月度视图</span> <svg class="logo svelte-plcc5o" style="fill: #fbc400;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M109.714286 950.857143l164.571429 0 0-164.571429-164.571429 0 0 164.571429zM310.857143 950.857143l182.857143 0 0-164.571429-182.857143 0 0 164.571429zM109.714286 749.714286l164.571429 0 0-182.857143-164.571429 0 0 182.857143zM310.857143 749.714286l182.857143 0 0-182.857143-182.857143 0 0 182.857143zM109.714286 530.285714l164.571429 0 0-164.571429-164.571429 0 0 164.571429zM530.285714 950.857143l182.857143 0 0-164.571429-182.857143 0 0 164.571429zM310.857143 530.285714l182.857143 0 0-164.571429-182.857143 0 0 164.571429zM749.714286 950.857143l164.571429 0 0-164.571429-164.571429 0 0 164.571429zM530.285714 749.714286l182.857143 0 0-182.857143-182.857143 0 0 182.857143zM329.142857 256l0-164.571429q0-7.460571-5.412571-12.873143t-12.873143-5.412571l-36.571429 0q-7.460571 0-12.873143 5.412571t-5.412571 12.873143l0 164.571429q0 7.460571 5.412571 12.873143t12.873143 5.412571l36.571429 0q7.460571 0 12.873143-5.412571t5.412571-12.873143zM749.714286 749.714286l164.571429 0 0-182.857143-164.571429 0 0 182.857143zM530.285714 530.285714l182.857143 0 0-164.571429-182.857143 0 0 164.571429zM749.714286 530.285714l164.571429 0 0-164.571429-164.571429 0 0 164.571429zM768 256l0-164.571429q0-7.460571-5.412571-12.873143t-12.873143-5.412571l-36.571429 0q-7.460571 0-12.873143 5.412571t-5.412571 12.873143l0 164.571429q0 7.460571 5.412571 12.873143t12.873143 5.412571l36.571429 0q7.460571 0 12.873143-5.412571t5.412571-12.873143zM987.428571 219.428571l0 731.428571q0 29.696-21.723429 51.419429t-51.419429 21.723429l-804.571429 0q-29.696 0-51.419429-21.723429t-21.723429-51.419429l0-731.428571q0-29.696 21.723429-51.419429t51.419429-21.723429l73.142857 0 0-54.857143q0-37.741714 26.843429-64.585143t64.585143-26.843429l36.571429 0q37.741714 0 64.585143 26.843429t26.843429 64.585143l0 54.857143 219.428571 0 0-54.857143q0-37.741714 26.843429-64.585143t64.585143-26.843429l36.571429 0q37.741714 0 64.585143 26.843429t26.843429 64.585143l0 54.857143 73.142857 0q29.696 0 51.419429 21.723429t21.723429 51.419429z" class="svelte-plcc5o"></path></svg></button> <div class="month-nav svelte-plcc5o"><button class="tooltip-container svelte-plcc5o" aria-label="previous_month"><span class="tooltip svelte-plcc5o">上一天</span> <svg class="logo svelte-plcc5o" style="fill: #fbc400;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M629.291 840.832l60.331-60.331-268.501-268.501 268.501-268.501-60.331-60.331-328.832 328.832z" class="svelte-plcc5o"></path></svg></button> <input type="date" class="date-input svelte-plcc5o"> <button class="tooltip-container svelte-plcc5o" aria-label="next_month"><span class="tooltip svelte-plcc5o">下一天</span> <svg class="logo svelte-plcc5o" style="fill: #fbc400;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M689.621 512l-328.832-328.832-60.331 60.331 268.501 268.501-268.501 268.501 60.331 60.331z" class="svelte-plcc5o"></path></svg></button></div> <button class="tooltip-container svelte-plcc5o" aria-label="about"><span class="tooltip svelte-plcc5o">数据源设置</span> <svg class="logo svelte-plcc5o" style="width: 30px;height: 30px" fill="#fbc400" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M369.777778 455.111111h284.444444c17.066667 0 28.444444 11.377778 28.444445 28.444445s-11.377778 28.444444-28.444445 28.444444h-284.444444c-17.066667 0-28.444444-11.377778-28.444445-28.444444s11.377778-28.444444 28.444445-28.444445z" class="svelte-plcc5o"></path><path d="M56.888889 483.555556C56.888889 625.777778 170.666667 739.555556 312.888889 739.555556H398.222222v-56.888889H312.888889C204.8 682.666667 113.777778 591.644444 113.777778 483.555556S204.8 284.444444 312.888889 284.444444H398.222222V227.555556H312.888889C170.666667 227.555556 56.888889 341.333333 56.888889 483.555556zM711.111111 227.555556H625.777778v56.888888h85.333333C819.2 284.444444 910.222222 375.466667 910.222222 483.555556S819.2 682.666667 711.111111 682.666667H625.777778v56.888889h85.333333C853.333333 739.555556 967.111111 625.777778 967.111111 483.555556S853.333333 227.555556 711.111111 227.555556z" class="svelte-plcc5o"></path></svg></button></div> <div class="table-container svelte-plcc5o"><div class="table-wrapper svelte-plcc5o"><!></div></div>',1),tt=d('<div class="svelte-plcc5o"> </div>'),st=d('<div class="loading-container svelte-plcc5o"><div class="loading-spinner-wrapper svelte-plcc5o"><div class="loading-spinner svelte-plcc5o"></div></div> <span class="loading-text svelte-plcc5o">加载中...</span></div>'),at=d('<main class="container svelte-plcc5o"><!></main>');function wt(E,u){ke(u,!0);const q=ye(),K=()=>ie(Y,"$modalStore",q),f=()=>ie(e(k),"$selectedDate",q),_e=(s,t=Q,o=Q,r=Q,_=Q)=>{var v=Ve(),g=l(v);P(g,()=>o().status!=="in_service",p=>{var w=Le();w.__click=[Ce];var C=l(w),h=i(C,4),n=l(h,!0);x(()=>S(n,o().status.replaceAll("_"," "))),a(h),a(w),x(()=>ne(C,`${`${t()==="T5"?"tooltip-top":"tooltip"}`??""} svelte-plcc5o`)),c(p,w)},p=>{var w=ve(),C=F(w);ae(C,()=>Promise.resolve(r().filter(h=>h.time_slot===t()&&h.station_id===o().id)[0]),h=>{var n=Ke();c(h,n)},(h,n)=>{var V=ve(),T=F(V);P(T,()=>e(n),y=>{var m=Oe();m.__click=()=>{Y.open(Ie,{reservation:e(n)})};var $=l(m),L=i($,2),R=l(L),j=i(l(R),2),N=l(j,!0);a(j),a(R);var M=i(R,2),D=i(l(M),2),z=l(D,!0);a(D),a(M),a(L);var H=i(L,2);P(H,()=>e(n).job_no||e(n).product_name||e(n).client_name,se=>{var G=Ne(),J=i(F(G),2);P(J,()=>e(n).job_no,O=>{var b=Pe(),U=l(b,!0);a(b),x(()=>S(U,e(n).job_no)),c(O,b)});var X=i(J,2);P(X,()=>e(n).product_name,O=>{var b=Re(),U=l(b,!0);a(b),x(()=>S(U,e(n).product_name)),c(O,b)});var be=i(X,2);P(be,()=>e(n).client_name,O=>{var b=je(),U=l(b,!0);a(b),x(()=>S(U,e(n).client_name)),c(O,b)}),c(se,G)}),a(m),x(()=>{ne($,`${(t()==="T5"?"tooltip-top":"tooltip")??""} svelte-plcc5o`),S(N,e(n).project_engineer),S(z,e(n).testing_engineer)}),c(y,m)},y=>{var m=Ue(),$=l(m);Se(2),a(m),x(()=>ne($,`${(t()==="T5"?"tooltip-top":"tooltip")??""} svelte-plcc5o`)),c(y,m)}),c(h,V)}),c(p,w)}),a(v),x(()=>de(v,"station-unavailable",o().status!=="in_service")),c(s,v)},ge=u.data.date??new Date().toISOString().split("T")[0];I.setDate(ge);const k=De(()=>I.selectedDate);async function we(){let s=[],t=[],o=[];try{A("run_mode")==="page"?(t=await ee.get("/stations"),o=await ee.get("/sevents")):(t=await W.getAllStations(),o=await W.getAllSevents()),console.log(t);const r=A("station_orders");return console.log(r),r&&r.length>0&&t.length>0?s=[...t.map(v=>{const g=r.find(p=>p.id===v.id);return{...v,sequence_no:(g==null?void 0:g.seq)??1}})].sort((v,g)=>v.sequence_no-g.sequence_no):s=[...t],s=s.map(_=>{const v=o.filter(g=>g.station_id===_.id);if(v.length===0)return{..._,status:"in_service"};if(v.some(p=>new Date(Z(e(k)))>=new Date(p.from_date)&&new Date(Z(e(k)))<=new Date(p.to_date))){const p=v.find(w=>new Date(Z(e(k)))>=new Date(w.from_date)&&new Date(Z(e(k)))<=new Date(w.to_date));return{..._,status:(p==null?void 0:p.name)??"unavailable"}}else return{..._,status:"in_service"}}),s}catch(r){return ce.handleError(r),[]}}async function B(s){let t=[];if(A("run_mode")==="page")return t=await ee.get(`/reservations/date/${s}`),t;try{return t=await W.getReservationsByDate(s),t}catch(o){return ce.handleError(o),[]}}const he=async()=>A("run_mode")==="page"?await ee.get("/sevents"):await W.getAllSevents(),me=async(s,t)=>{const o=await we();console.log(o);const r=await B(s),_=await he();return{stations:o,res:r,sevents:_}},ue=async()=>{const s=A("user"),t=A("tests"),o=A("project_engineers"),r=A("testing_engineers");(!s||!t||!o||!r)&&await Ae(),await new Promise(_=>setTimeout(_,100))},re=s=>{if(K().show){const t=s.target;!(t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.isContentEditable)&&(s.key==="ArrowLeft"||s.key==="ArrowRight")&&s.preventDefault();return}s.key==="ArrowLeft"?(I.previous(),B(f())):s.key==="ArrowRight"&&(I.next(),B(f()))};Ee(()=>(window.addEventListener("keydown",re),()=>window.removeEventListener("keydown",re)));var te=at(),fe=l(te);ae(fe,ue,s=>{var t=st();c(s,t)},(s,t)=>{var o=et(),r=F(o),_=l(r);_.__click=[Ge];var v=i(_,2),g=l(v);g.__click=[Je,B,f,k];var p=i(g,2);qe(p),p.__change=[Xe,B,f,k];var w=i(p,2);w.__click=[Fe,B,f,k],a(v);var C=i(v,2);C.__click=()=>Y.open(He,{onNegative:()=>Y.close()}),a(r);var h=i(r,2),n=l(h),V=l(n);ae(V,()=>me(f()),T=>{var y=Ze();c(T,y)},(T,y)=>{var m=Ye(),$=l(m),L=l($),R=i(l(L));le(R,17,()=>e(y).stations,oe,(N,M)=>{var D=Qe(),z=i(l(D),2),H=l(z,!0);a(z),a(D),x(()=>{de(D,"station-unavailable",e(M).status!=="in_service"),pe(z,"title",e(M).name),pe(z,"href",`/station?stationId=${e(M).id}&date=${f()}`),S(H,e(M).short_name)}),c(N,D)}),a(L),a($);var j=i($);le(j,20,()=>["9:30-12:00","13:00-15:00","15:00-17:30","18:00-20:30","20:30-23:59"],oe,(N,M,D)=>{var z=We(),H=l(z),se=l(H,!0);a(H);var G=i(H);le(G,17,()=>e(y).stations,oe,(J,X)=>{_e(J,()=>`T${D+1}`,()=>e(X),()=>e(y).res,()=>e(y).sevents)}),a(z),x(()=>S(se,M)),c(N,z)}),a(j),a(m),c(T,m)}),a(n),a(h),$e(p,f,T=>ze(e(k),T)),c(s,o)},(s,t)=>{var o=tt(),r=l(o,!0);a(o),x(()=>S(r,"Error: "+e(t).message)),c(s,o)}),a(te),c(E,te),Me()}xe(["click","change"]);export{wt as component,gt as universal};
