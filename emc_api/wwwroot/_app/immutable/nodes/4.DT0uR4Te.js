import{d as Ee,s as je,a,t as s,f as U,c as ie,b as H,e as Ne}from"../chunks/disclose-version.CoNHZQ4F.js";import{I as Oe,L as Be,M as l,N as n,K as D,J as L,O as c,d as e,D as Re,C as I,Q as we,c as fe}from"../chunks/utils.sQOqgOVm.js";import{g as j,c as d,a as Q,r as Ve,e as X,b as Ue,d as Fe,i as Z}from"../chunks/calendar.CqQHU_F5.js";import{i as z}from"../chunks/if.DSc5eMOV.js";import{m as q,a as ce,e as ye,t as W,s as Ke}from"../chunks/modalStore.CRgIuiNX.js";import{p as Ge}from"../chunks/proxy.BaDoOCpl.js";import{o as Je}from"../chunks/index-client.DKsD9lEg.js";import{g as Qe}from"../chunks/entry.DA97GV68.js";import{S as Xe,e as Ze,R as qe,c as We}from"../chunks/Source.DadVaUDN.js";const Ye=({url:f})=>{const h=f.searchParams.get("stationId"),A=f.searchParams.get("date");return console.log(h),{stationId:h,date:A}},Et=Object.freeze(Object.defineProperty({__proto__:null,load:Ye},Symbol.toStringTag,{value:"Module"}));var et=s('<span class="station-badge in_service svelte-hv4plx">正常</span>'),tt=s('<span class="station-badge out_of_service svelte-hv4plx">停用</span>'),at=s('<span class="station-badge maintenance svelte-hv4plx">维护</span>'),st=s('<span class="station-badge calibration svelte-hv4plx">校准</span>'),ot=s('<span class="station-badge unknown svelte-hv4plx">未知状态</span>'),nt=(f,h,A)=>Qe(`/date?date=${h()}`),lt=s('<img class="station-image svelte-hv4plx" alt="station_pic">'),vt=s('<svg class="image-placeholder svelte-hv4plx" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4 16L8.586 11.414C8.96106 11.0391 9.46967 10.8284 10 10.8284C10.5303 10.8284 11.0389 11.0391 11.414 11.414L16 16M14 14L15.586 12.414C15.9611 12.0391 16.4697 11.8284 17 11.8284C17.5303 11.8284 18.0389 12.0391 18.414 12.414L20 14M14 8H14.01M6 20H18C18.5304 20 19.0391 19.7893 19.4142 19.4142C19.7893 19.0391 20 18.5304 20 18V6C20 5.46957 19.7893 4.96086 19.4142 4.58579C19.0391 4.21071 18.5304 4 18 4H6C5.46957 4 4.96086 4.21071 4.58579 4.58579C4.21071 4.96086 4 5.46957 4 6V18C4 18.5304 4.21071 19.0391 4.58579 19.4142C4.96086 19.7893 5.46957 20 6 20Z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-hv4plx"></path></svg>'),rt=s('<div class="station-details svelte-hv4plx"><div class="station-name-container svelte-hv4plx"><div class="station-name svelte-hv4plx"> <!></div> <p class="station-description svelte-hv4plx"> </p></div> <!></div>'),it=s('<div class="loading-spinner svelte-hv4plx">加载中...</div>'),ct=()=>d.changeMonth(-1),dt=(f,h)=>h(),pt=()=>d.changeMonth(1),ht=s('<div class="day empty other-month svelte-hv4plx"> </div>'),_t=(f,h)=>{f.preventDefault(),f.stopPropagation(),d.setDate(e(h))},gt=s('<span class="tooltip svelte-hv4plx"> </span>'),xt=s('<div class="slot tooltip-container svelte-hv4plx"><!></div>'),mt=s('<div style="display: flex;flex-direction:column;" class="svelte-hv4plx"></div>'),ut=s('<div><!> <div class="day_no svelte-hv4plx" style="z-index: 0;"> </div></div>'),wt=s('<div class="day empty other-month svelte-hv4plx"> </div>'),ft=s('<div class="month-nav svelte-hv4plx"><button class="tooltip-container svelte-hv4plx" aria-label="previous_month"><span class="tooltip svelte-hv4plx">上个月</span> <svg class="logo svelte-hv4plx" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M629.291 840.832l60.331-60.331-268.501-268.501 268.501-268.501-60.331-60.331-328.832 328.832z" class="svelte-hv4plx"></path></svg></button> <input type="month" class="svelte-hv4plx"> <button class="tooltip-container svelte-hv4plx" aria-label="next_month"><span class="tooltip svelte-hv4plx">下个月</span> <svg class="logo svelte-hv4plx" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M689.621 512l-328.832-328.832-60.331 60.331 268.501 268.501-268.501 268.501 60.331 60.331z" class="svelte-hv4plx"></path></svg></button></div> <div class="calendar svelte-hv4plx"><div class="weekdays svelte-hv4plx"><div style="text-align: center;" class="svelte-hv4plx">日</div> <div style="text-align: center;" class="svelte-hv4plx">一</div> <div style="text-align: center;" class="svelte-hv4plx">二</div> <div style="text-align: center;" class="svelte-hv4plx">三</div> <div style="text-align: center;" class="svelte-hv4plx">四</div> <div style="text-align: center;" class="svelte-hv4plx">五</div> <div style="text-align: center;" class="svelte-hv4plx">六</div></div> <div class="days svelte-hv4plx"><!> <!> <!></div></div>',1),yt=s('<div class="loading-container svelte-hv4plx"><div class="loading-spinner-wrapper svelte-hv4plx"><div class="loading-spinner svelte-hv4plx"></div></div> <span class="loading-text svelte-hv4plx">加载中...</span></div>'),bt=s('<header class="station-info svelte-hv4plx"><div class="header-content svelte-hv4plx"><button aria-label="home" class="tooltip-container svelte-hv4plx"><span class="tooltip-bottom svelte-hv4plx">返回工位列表</span> <svg class="home_svg svelte-hv4plx" viewBox="0 0 1280 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M1271.872 986.624c10.944-9.344 17.6-15.04-26.368-198.656-76.288-317.888-378.816-523.008-717.504-553.6V0L0 410.048l528 410.048V585.792c219.52-16.64 412.352 2.496 541.44 141.184 63.808 68.48 140.608 204.16 159.04 244.096 2.56 5.632 7.424 16.064 19.008 20.032l14.016 4.48 10.368-8.96z" class="svelte-hv4plx"></path></svg></button> <!> <button class="tooltip-container svelte-hv4plx" aria-label="about"><span class="tooltip svelte-hv4plx">数据源设置</span> <svg class="logo svelte-hv4plx" style="width: 30px;height: 30px" fill="#fbc400" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M369.777778 455.111111h284.444444c17.066667 0 28.444444 11.377778 28.444445 28.444445s-11.377778 28.444444-28.444445 28.444444h-284.444444c-17.066667 0-28.444444-11.377778-28.444445-28.444444s11.377778-28.444444 28.444445-28.444445z" class="svelte-hv4plx"></path><path d="M56.888889 483.555556C56.888889 625.777778 170.666667 739.555556 312.888889 739.555556H398.222222v-56.888889H312.888889C204.8 682.666667 113.777778 591.644444 113.777778 483.555556S204.8 284.444444 312.888889 284.444444H398.222222V227.555556H312.888889C170.666667 227.555556 56.888889 341.333333 56.888889 483.555556zM711.111111 227.555556H625.777778v56.888888h85.333333C819.2 284.444444 910.222222 375.466667 910.222222 483.555556S819.2 682.666667 711.111111 682.666667H625.777778v56.888889h85.333333C853.333333 739.555556 967.111111 625.777778 967.111111 483.555556S853.333333 227.555556 711.111111 227.555556z" class="svelte-hv4plx"></path></svg></button></div></header> <div class="calendar-container svelte-hv4plx"><!></div>',1),Mt=s('<div class="svelte-hv4plx"> </div>'),kt=s('<div class="loading-container svelte-hv4plx"><div class="loading-spinner-wrapper svelte-hv4plx"><div class="loading-spinner svelte-hv4plx"></div></div> <span class="loading-text svelte-hv4plx">加载中...</span></div>'),Dt=s('<div class="container svelte-hv4plx"><!></div>');function jt(f,h){Oe(h,!0);const A=je(),C=()=>ie(de,"$currentMonth",A),be=()=>ie(q,"$modalStore",A),F=()=>ie(e(pe),"$selectedDate",A),Me=(t,o=Re)=>{var i=U(),v=L(i);z(v,()=>o()==="in_service",y=>{var _=et();a(y,_)},y=>{var _=U(),N=L(_);z(N,()=>o()==="out_of_service",b=>{var u=tt();a(b,u)},b=>{var u=U(),ae=L(u);z(ae,()=>o()==="maintenance",g=>{var r=at();a(g,r)},g=>{var r=U(),S=L(r);z(S,()=>o()==="calibration",M=>{var $=st();a(M,$)},M=>{var $=ot();a(M,$)},!0),a(g,r)},!0),a(b,u)},!0),a(y,_)}),a(t,i)};let{stationId:Y,date:$t}=h.data,K=we(!1);console.log(Y),j("run_mode");const de=d.currentMonth;let pe=I(()=>d.selectedDate);async function he(){let t=[];try{return t=await ce.get(`/reservations/station/${Y}?month=${C()}`),t}catch(o){return ye.handleError(o),[]}}const ke=I(()=>d.getFirstDayOfMonth(C())),De=I(()=>d.getCalendarDays(C()));let ee=we(!1);async function $e(t,o,i){console.log("start to load StationInfo");let v;v=[await ce.get(`/stations/${t}`)],console.log(v),fe(ee,Ge(await Ze(_e(v[0].photo_path)))),console.log(e(ee));let _=[];_=[await ce.get(`/sevents/station/${t}`)],console.log(_);const b=_.filter(u=>new Date(u.from_date)<=new Date(i)&&new Date(u.to_date)>=new Date(i));return console.log(b),v[0].status=b.length===0?"in_service":b[0].name,fe(K,v[0].status!=="in_service"),console.log(v),v[0]}let Ce=0;const Se=t=>We(_e(t)),_e=t=>t.includes(":")?t:`${j("remote_source")}\\station_pics\\${t}`,ge=t=>{if(be().show){const o=t.target;!(o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable)&&(t.key==="ArrowLeft"||t.key==="ArrowRight")&&t.preventDefault();return}t.key==="ArrowLeft"?d.changeMonth(-1):t.key==="ArrowRight"&&d.changeMonth(1)};Je(()=>(window.addEventListener("keydown",ge),()=>window.removeEventListener("keydown",ge)));const Pe=async()=>{const t=j("user"),o=j("tests"),i=j("project_engineers"),v=j("testing_engineers");(!t||!o||!i||!v)&&await init(),await new Promise(y=>setTimeout(y,200))};var te=Dt(),Te=l(te);Q(Te,Pe,t=>{var o=kt();a(t,o)},(t,o)=>{var i=bt(),v=L(i),y=l(v),_=l(y);_.__click=[nt,F,pe];var N=c(_,2);Q(N,()=>$e(Y||"1",Ce,F()),g=>{var r=it();a(g,r)},(g,r)=>{var S=U(),M=L(S);z(M,()=>e(r),$=>{var k=rt(),O=l(k),P=l(O),B=l(P),G=c(B);Me(G,()=>e(r).status),n(P);var R=c(P,2),xe=l(R,!0);n(R),n(O);var se=c(O,2);z(se,()=>e(ee),x=>{var w=lt();D(()=>Fe(w,"src",Se(e(r).photo_path))),a(x,w)},x=>{var w=vt();a(x,w)}),n(k),D(()=>{W(k,"disableStation",e(K)),H(B,`${e(r).name??"Unknown"??""} `),H(xe,e(r).description??"Unknown")}),a($,k)}),a(g,S)});var b=c(N,2);b.__click=()=>q.open(Xe,{onNegative:()=>q.close()}),n(y),n(v);var u=c(v,2),ae=l(u);Q(ae,he,g=>{var r=yt();a(g,r)},(g,r)=>{var S=ft(),M=L(S),$=l(M);$.__click=[ct];var k=c($,2);Ve(k),k.__change=[dt,he];var O=c(k,2);O.__click=[pt],n(M);var P=c(M,2),B=c(l(P),2),G=l(B);X(G,17,()=>Array(e(ke)),Z,(x,w,p)=>{var m=ht();const oe=I(()=>d.getPreviousMonthDays(C())[p]);var J=l(m,!0);n(m),D(()=>H(J,e(oe))),a(x,m)});var R=c(G,2);X(R,17,()=>e(De),Z,(x,w)=>{var p=ut();const m=I(()=>`${C()}-${e(w).toString().padStart(2,"0")}`),oe=I(()=>`day ${(d.isToday(e(m))?"today":"")??""} svelte-hv4plx`);p.__click=[_t,m];var J=l(p);Q(J,()=>new Promise(ne=>ne(e(r).filter(le=>le.reservation_date===e(m)))),null,(ne,le)=>{var ve=mt();X(ve,20,()=>["T1","T2","T3","T4","T5"],Z,(Le,Ie)=>{var V=xt();const T=I(()=>e(le).filter(E=>E.time_slot===Ie));V.__click=async E=>{e(K)||(E.preventDefault(),E.stopPropagation(),d.setDate(e(m)),console.log(F()),console.log("Opening modal with reservation:",e(T)[0]),e(T).length>0?(console.log(e(T)[0]),q.open(qe,{reservation:e(T)[0]})):ye.showInfo("无预约"))};var ze=l(V);z(ze,()=>e(T).length>0,E=>{var re=gt(),Ae=l(re,!0);n(re),D(()=>{var ue;return H(Ae,(ue=e(T)[0])==null?void 0:ue.project_engineer)}),a(E,re)}),n(V),D(()=>W(V,"fill_slot",e(T).length>0)),a(Le,V)}),n(ve),a(ne,ve)});var me=c(J,2),He=l(me,!0);n(me),n(p),D(()=>{Ke(p,e(oe)),W(p,"selectedDay",F()===e(m)),H(He,e(w))}),a(x,p)});var se=c(R,2);X(se,1,()=>d.getNextMonthDays(C()),Z,(x,w)=>{var p=wt(),m=l(p,!0);n(p),D(()=>H(m,e(w))),a(x,p)}),n(B),n(P),D(()=>W(P,"disableStation",e(K))),Ue(k,C,x=>Ne(de,x)),a(g,S)}),n(u),a(t,i)},(t,o)=>{var i=Mt(),v=l(i,!0);n(i),D(()=>H(v,"Error: "+e(o).message+" "+e(o).details)),a(t,i)}),n(te),a(f,te),Be()}Ee(["click","change"]);export{jt as component,Et as universal};
