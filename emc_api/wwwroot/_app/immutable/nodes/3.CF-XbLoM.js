import{d as xe,s as ye,a as c,t as h,c as ie,b as D,e as ze,f as ve}from"../chunks/disclose-version.CoNHZQ4F.js";import{I as ke,L as Me,M as l,O as n,K as b,N as s,J as Q,d as t,C as De,P as Se,D as W}from"../chunks/utils.sQOqgOVm.js";import{g as ce,c as H,a as ae,r as qe,e as le,b as $e,s as B,d as de,i as oe}from"../chunks/calendar.CqQHU_F5.js";import{i as P}from"../chunks/if.DSc5eMOV.js";import{m as Y,a as G,e as ee,t as he,s as ne}from"../chunks/modalStore.CRgIuiNX.js";import{o as Ee}from"../chunks/index-client.DKsD9lEg.js";import{g as Te}from"../chunks/entry.DA97GV68.js";import{S as He,R as Ae}from"../chunks/Source.DadVaUDN.js";import{g as Z}from"../chunks/index.dAKAKWrd.js";const Ie=({url:$})=>{const u=$.searchParams.get("date");return console.log(u),{date:u}},mt=Object.freeze(Object.defineProperty({__proto__:null,load:Ie},Symbol.toStringTag,{value:"Module"}));var Ce=()=>ee.showInfo("工位不可用"),Be=h('<button class="tooltip-container unavailable-cell svelte-j9m98h"><span>工位不可用</span> <svg class="logo svelte-j9m98h" style="fill: #fbc400;opacity:0.8" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M821.344 458.656v106.688H202.656v-106.688h618.688zM1024 512c0 282.784-229.216 512-512 512S0 794.784 0 512 229.216 0 512 0s512 229.216 512 512z m-85.344 0c0-235.264-191.392-426.656-426.656-426.656S85.344 276.736 85.344 512 276.736 938.656 512 938.656 938.656 747.264 938.656 512z" class="svelte-j9m98h"></path></svg> <span style="font-size: 0.8rem;margin-top:0.5rem" class="first-letter-capital svelte-j9m98h"> </span></button>'),Pe=h('<div style="font-size: smaller; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;" class="svelte-j9m98h"> </div>'),Le=h('<div style="font-size: smaller; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;" class="svelte-j9m98h"> </div>'),Re=h('<div style="font-size: smaller; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%;" class="svelte-j9m98h"> </div>'),Ne=h('<div class="divider svelte-j9m98h"></div> <!> <!> <!>',1),Oe=h('<button style="gap: 5px; display: flex; flex-direction: column; align-items: center; width: 100%;" class="tooltip-container svelte-j9m98h"><span>点击查看预约</span> <div class="engineer-info svelte-j9m98h" style="display: flex; flex-direction: column; gap: 0.25rem; font-size: 0.75rem;"><div class="engineer-item svelte-j9m98h" style="display: flex; align-items: center; gap: 0.25rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"><span class="badge svelte-j9m98h" style="background-color: #e2e8f0; color: #475569; padding: 0.125rem 0.25rem; border-radius: 0.25rem; font-size: 0.7rem; font-weight: 600; flex-shrink: 0;">PE</span> <span class="name svelte-j9m98h" style="color: #1e293b; overflow: hidden; text-overflow: ellipsis;"> </span></div> <div class="engineer-item svelte-j9m98h" style="display: flex; align-items: center; gap: 0.25rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"><span class="badge svelte-j9m98h" style="background-color: #e2e8f0; color: #475569; padding: 0.125rem 0.25rem; border-radius: 0.25rem; font-size: 0.7rem; font-weight: 600; flex-shrink: 0;">TE</span> <span class="name svelte-j9m98h" style="color: #1e293b; overflow: hidden; text-overflow: ellipsis;"> </span></div></div> <!></button>'),Ue=h('<button class="tooltip-container coffee-btn svelte-j9m98h" aria-label="open_new"><span>无预约</span> <svg class="logo spare svelte-j9m98h" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M797.994667 448.725333v123.306667a243.626667 243.626667 0 0 1-243.626667 243.669333H371.626667A243.626667 243.626667 0 0 1 128 572.074667V358.826667c0-16.810667 13.653333-30.421333 30.464-30.421334h119.381333C292.096 319.146667 298.666667 305.408 298.666667 285.184c0-13.098667-6.058667-23.253333-25.344-44.928l-3.541334-4.010667c-23.125333-26.112-32.725333-42.538667-32.554666-67.114666 0.256-37.333333 15.658667-65.536 45.482666-81.322667a21.333333 21.333333 0 0 1 19.968 37.717333c-15.232 8.064-22.613333 21.589333-22.784 43.946667-0.085333 10.581333 5.376 19.925333 21.845334 38.485333l3.498666 3.968c25.984 29.226667 36.096 46.08 36.096 73.258667 0 16.128-2.986667 30.634667-8.874666 43.264h116.010666c14.250667-9.301333 20.864-23.04 20.864-43.264 0-13.098667-6.058667-23.253333-25.344-44.928l-3.541333-4.010667c-23.125333-26.112-32.725333-42.538667-32.554667-67.114666 0.256-37.333333 15.658667-65.536 45.482667-81.322667a21.333333 21.333333 0 1 1 19.968 37.717333c-15.232 8.064-22.613333 21.589333-22.784 43.946667-0.085333 10.581333 5.376 19.925333 21.845333 38.485333l3.498667 3.968c25.984 29.226667 36.096 46.08 36.096 73.258667 0 16.128-2.986667 30.634667-8.874667 43.264h93.696c16.853333 0 30.464 13.610667 30.464 30.421333v46.976A149.333333 149.333333 0 1 1 810.666667 704a21.333333 21.333333 0 1 1 0-42.666667 106.666667 106.666667 0 1 0-12.672-212.608zM213.333333 917.333333a21.333333 21.333333 0 1 1 0-42.666666h512a21.333333 21.333333 0 1 1 0 42.666666H213.333333z" class="svelte-j9m98h"></path></svg></button>'),Ge=h('<div class="svelte-j9m98h">Loading...</div>'),Ke=h('<td class="fixed-width svelte-j9m98h" style="text-align:left;font-size:12px;"><!></td>'),Ve=()=>Te("/"),Je=($,u,S,K)=>{H.previous(),u(S())},Xe=($,u,S,K)=>{var f;H.setDate((f=$.target)==null?void 0:f.value),u(S())},Fe=($,u,S,K)=>{H.next(),u(S())},Qe=h('<th class="fixed-width tooltip-container svelte-j9m98h"><span class="tooltip svelte-j9m98h">点击查看工位详情</span> <a class="link svelte-j9m98h"> </a></th>'),We=h('<tr class="svelte-j9m98h"><td class="sticky-column svelte-j9m98h"> </td><!></tr>'),Ye=h('<table class="svelte-j9m98h"><thead class="svelte-j9m98h"><tr class="svelte-j9m98h"><th class="sticky-column svelte-j9m98h">时间</th><!></tr></thead><tbody class="svelte-j9m98h"></tbody></table>'),Ze=h('<div class="loading-container svelte-j9m98h"><div class="loading-spinner-wrapper svelte-j9m98h"><div class="loading-spinner svelte-j9m98h"></div></div> <span class="loading-text svelte-j9m98h">加载中...</span></div>'),et=h('<div class="fixed-header svelte-j9m98h"><button aria-label="calendar_view" class="tooltip-container svelte-j9m98h"><span class="tooltip svelte-j9m98h">返回月度视图</span> <svg class="logo svelte-j9m98h" style="fill: #fbc400;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M109.714286 950.857143l164.571429 0 0-164.571429-164.571429 0 0 164.571429zM310.857143 950.857143l182.857143 0 0-164.571429-182.857143 0 0 164.571429zM109.714286 749.714286l164.571429 0 0-182.857143-164.571429 0 0 182.857143zM310.857143 749.714286l182.857143 0 0-182.857143-182.857143 0 0 182.857143zM109.714286 530.285714l164.571429 0 0-164.571429-164.571429 0 0 164.571429zM530.285714 950.857143l182.857143 0 0-164.571429-182.857143 0 0 164.571429zM310.857143 530.285714l182.857143 0 0-164.571429-182.857143 0 0 164.571429zM749.714286 950.857143l164.571429 0 0-164.571429-164.571429 0 0 164.571429zM530.285714 749.714286l182.857143 0 0-182.857143-182.857143 0 0 182.857143zM329.142857 256l0-164.571429q0-7.460571-5.412571-12.873143t-12.873143-5.412571l-36.571429 0q-7.460571 0-12.873143 5.412571t-5.412571 12.873143l0 164.571429q0 7.460571 5.412571 12.873143t12.873143 5.412571l36.571429 0q7.460571 0 12.873143-5.412571t5.412571-12.873143zM749.714286 749.714286l164.571429 0 0-182.857143-164.571429 0 0 182.857143zM530.285714 530.285714l182.857143 0 0-164.571429-182.857143 0 0 164.571429zM749.714286 530.285714l164.571429 0 0-164.571429-164.571429 0 0 164.571429zM768 256l0-164.571429q0-7.460571-5.412571-12.873143t-12.873143-5.412571l-36.571429 0q-7.460571 0-12.873143 5.412571t-5.412571 12.873143l0 164.571429q0 7.460571 5.412571 12.873143t12.873143 5.412571l36.571429 0q7.460571 0 12.873143-5.412571t5.412571-12.873143zM987.428571 219.428571l0 731.428571q0 29.696-21.723429 51.419429t-51.419429 21.723429l-804.571429 0q-29.696 0-51.419429-21.723429t-21.723429-51.419429l0-731.428571q0-29.696 21.723429-51.419429t51.419429-21.723429l73.142857 0 0-54.857143q0-37.741714 26.843429-64.585143t64.585143-26.843429l36.571429 0q37.741714 0 64.585143 26.843429t26.843429 64.585143l0 54.857143 219.428571 0 0-54.857143q0-37.741714 26.843429-64.585143t64.585143-26.843429l36.571429 0q37.741714 0 64.585143 26.843429t26.843429 64.585143l0 54.857143 73.142857 0q29.696 0 51.419429 21.723429t21.723429 51.419429z" class="svelte-j9m98h"></path></svg></button> <div class="month-nav svelte-j9m98h"><button class="tooltip-container svelte-j9m98h" aria-label="previous_month"><span class="tooltip svelte-j9m98h">上一天</span> <svg class="logo svelte-j9m98h" style="fill: #fbc400;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M629.291 840.832l60.331-60.331-268.501-268.501 268.501-268.501-60.331-60.331-328.832 328.832z" class="svelte-j9m98h"></path></svg></button> <input type="date" class="date-input svelte-j9m98h"> <button class="tooltip-container svelte-j9m98h" aria-label="next_month"><span class="tooltip svelte-j9m98h">下一天</span> <svg class="logo svelte-j9m98h" style="fill: #fbc400;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M689.621 512l-328.832-328.832-60.331 60.331 268.501 268.501-268.501 268.501 60.331 60.331z" class="svelte-j9m98h"></path></svg></button></div> <button class="tooltip-container svelte-j9m98h" aria-label="about"><span class="tooltip svelte-j9m98h">数据源设置</span> <svg class="logo svelte-j9m98h" style="width: 30px;height: 30px" fill="#fbc400" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="200" height="200"><path d="M369.777778 455.111111h284.444444c17.066667 0 28.444444 11.377778 28.444445 28.444445s-11.377778 28.444444-28.444445 28.444444h-284.444444c-17.066667 0-28.444444-11.377778-28.444445-28.444444s11.377778-28.444444 28.444445-28.444445z" class="svelte-j9m98h"></path><path d="M56.888889 483.555556C56.888889 625.777778 170.666667 739.555556 312.888889 739.555556H398.222222v-56.888889H312.888889C204.8 682.666667 113.777778 591.644444 113.777778 483.555556S204.8 284.444444 312.888889 284.444444H398.222222V227.555556H312.888889C170.666667 227.555556 56.888889 341.333333 56.888889 483.555556zM711.111111 227.555556H625.777778v56.888888h85.333333C819.2 284.444444 910.222222 375.466667 910.222222 483.555556S819.2 682.666667 711.111111 682.666667H625.777778v56.888889h85.333333C853.333333 739.555556 967.111111 625.777778 967.111111 483.555556S853.333333 227.555556 711.111111 227.555556z" class="svelte-j9m98h"></path></svg></button></div> <div class="table-container svelte-j9m98h"><div class="table-wrapper svelte-j9m98h"><!></div></div>',1),tt=()=>window.location.reload(),st=h('<div class="error-container svelte-j9m98h"><div class="error-icon svelte-j9m98h">❌</div> <div class="error-content svelte-j9m98h"><h3 class="error-title svelte-j9m98h">抱歉，出现了问题</h3> <p class="error-message svelte-j9m98h"> </p></div> <button class="retry-button svelte-j9m98h">重新加载</button></div>'),at=h('<div class="loading-container svelte-j9m98h"><div class="loading-spinner-wrapper svelte-j9m98h"><div class="loading-spinner svelte-j9m98h"></div></div> <span class="loading-text svelte-j9m98h">加载中...</span></div>'),lt=h('<main class="container svelte-j9m98h"><!></main>');function _t($,u){ke(u,!0);const S=ye(),K=()=>ie(Y,"$modalStore",S),f=()=>ie(t(z),"$selectedDate",S),pe=(e,a=W,o=W,i=W,p=W)=>{var v=Ke(),m=l(v);P(m,()=>o().status!=="in_service",d=>{var _=Be();_.__click=[Ce];var I=l(_),g=n(I,4),r=l(g,!0);b(()=>D(r,o().status.replaceAll("_"," "))),s(g),s(_),b(()=>ne(I,`${`${a()==="T5"?"tooltip-top":"tooltip"}`??""} svelte-j9m98h`)),c(d,_)},d=>{var _=ve(),I=Q(_);ae(I,()=>Promise.resolve(i().filter(g=>g.time_slot===a()&&g.station_id===o().id)[0]),g=>{var r=Ge();c(g,r)},(g,r)=>{var V=ve(),E=Q(V);P(E,()=>t(r),x=>{var w=Oe();w.__click=()=>{Y.open(Ae,{reservation:t(r)})};var q=l(w),C=n(q,2),L=l(C),R=n(l(L),2),N=l(R,!0);s(R),s(L);var k=n(L,2),M=n(l(k),2),y=l(M,!0);s(M),s(k),s(C);var T=n(C,2);P(T,()=>t(r).job_no||t(r).product_name||t(r).client_name,se=>{var J=Ne(),X=n(Q(J),2);P(X,()=>t(r).job_no,O=>{var j=Pe(),U=l(j,!0);s(j),b(()=>D(U,t(r).job_no)),c(O,j)});var F=n(X,2);P(F,()=>t(r).product_name,O=>{var j=Le(),U=l(j,!0);s(j),b(()=>D(U,t(r).product_name)),c(O,j)});var be=n(F,2);P(be,()=>t(r).client_name,O=>{var j=Re(),U=l(j,!0);s(j),b(()=>D(U,t(r).client_name)),c(O,j)}),c(se,J)}),s(w),b(()=>{ne(q,`${(a()==="T5"?"tooltip-top":"tooltip")??""} svelte-j9m98h`),D(N,t(r).project_engineer),D(y,t(r).testing_engineer)}),c(x,w)},x=>{var w=Ue(),q=l(w);Se(2),s(w),b(()=>ne(q,`${(a()==="T5"?"tooltip-top":"tooltip")??""} svelte-j9m98h`)),c(x,w)}),c(g,V)}),c(d,_)}),s(v),b(()=>he(v,"station-unavailable",o().status!=="in_service")),c(e,v)},me=ce("run_mode");console.log(me);const _e=u.data.date??new Date().toISOString().split("T")[0];H.setDate(_e);const z=De(()=>H.selectedDate);async function ge(){let e=[],a=[],o=[];try{a=await G.get("/stations"),o=await G.get("/sevents"),console.log(a);const i=ce("station_orders");return console.log(i),i&&i.length>0&&a.length>0?e=[...a.map(v=>{const m=i.find(d=>d.id===v.id);return{...v,sequence_no:(m==null?void 0:m.seq)??1}})].sort((v,m)=>v.sequence_no-m.sequence_no):e=[...a],o.length>0&&(e=e.map(p=>{const v=o.filter(m=>m.station_id===p.id);if(v.length===0)return{...p,status:"in_service"};if(v.some(d=>new Date(Z(t(z)))>=new Date(d.from_date)&&new Date(Z(t(z)))<=new Date(d.to_date))){const d=v.find(_=>new Date(Z(t(z)))>=new Date(_.from_date)&&new Date(Z(t(z)))<=new Date(_.to_date));return{...p,status:(d==null?void 0:d.name)??"unavailable"}}else return{...p,status:"in_service"}})),e}catch(i){return ee.handleError(i),[]}}async function A(e){let a=[];try{return a=await G.get(`/reservations/${e}`),a}catch(o){return ee.handleError(o),[]}}const we=async()=>{let e=[];try{return e=await G.get("/sevents"),e}catch(a){return ee.handleError(a),[]}},ue=async(e,a)=>{const o=await ge();console.log("stations:",o);const i=await A(e);console.log("reservations:",i);const p=await we();return console.log("sevents:",p),{stations:o,res:i,sevents:p}},fe=async()=>{const e=await G.get("/general/settings");B("tests",e.tests),B("project_engineers",e.project_engineers),B("testing_engineers",e.testing_engineers),B("loadSetting",e.loadSetting),B("station_orders",e.station_orders),B("user",{user:"page",machine:""}),await new Promise(a=>setTimeout(a,200))},re=e=>{if(K().show){const a=e.target;!(a.tagName==="INPUT"||a.tagName==="TEXTAREA"||a.isContentEditable)&&(e.key==="ArrowLeft"||e.key==="ArrowRight")&&e.preventDefault();return}e.key==="ArrowLeft"?(H.previous(),A(f())):e.key==="ArrowRight"&&(H.next(),A(f()))};Ee(()=>(window.addEventListener("keydown",re),()=>window.removeEventListener("keydown",re)));var te=lt(),je=l(te);ae(je,fe,e=>{var a=at();c(e,a)},(e,a)=>{var o=et(),i=Q(o),p=l(i);p.__click=[Ve];var v=n(p,2),m=l(v);m.__click=[Je,A,f,z];var d=n(m,2);qe(d),d.__change=[Xe,A,f,z];var _=n(d,2);_.__click=[Fe,A,f,z],s(v);var I=n(v,2);I.__click=()=>Y.open(He,{onNegative:()=>Y.close()}),s(i);var g=n(i,2),r=l(g),V=l(r);ae(V,()=>ue(f()),E=>{var x=Ze();c(E,x)},(E,x)=>{var w=Ye(),q=l(w),C=l(q),L=n(l(C));le(L,17,()=>t(x).stations,oe,(N,k)=>{var M=Qe(),y=n(l(M),2),T=l(y,!0);s(y),s(M),b(()=>{he(M,"station-unavailable",t(k).status!=="in_service"),de(y,"title",t(k).name),de(y,"href",`/station?stationId=${t(k).id}&date=${f()}`),D(T,t(k).short_name)}),c(N,M)}),s(C),s(q);var R=n(q);le(R,20,()=>["9:30-12:00","13:00-15:00","15:00-17:30","18:00-20:30","20:30-23:59"],oe,(N,k,M)=>{var y=We(),T=l(y),se=l(T,!0);s(T);var J=n(T);le(J,17,()=>t(x).stations,oe,(X,F)=>{pe(X,()=>`T${M+1}`,()=>t(F),()=>t(x).res,()=>t(x).sevents)}),s(y),b(()=>D(se,k)),c(N,y)}),s(R),s(w),c(E,w)}),s(r),s(g),$e(d,f,E=>ze(t(z),E)),c(e,o)},(e,a)=>{var o=st(),i=n(l(o),2),p=n(l(i),2),v=l(p,!0);b(()=>D(v,t(a).message+" "+t(a).details.originalError.toString())),s(p),s(i);var m=n(i,2);m.__click=[tt],s(o),c(e,o)}),s(te),c($,te),Me()}xe(["click","change"]);export{_t as component,mt as universal};
