var at=Object.defineProperty;var nt=(a,e,t)=>e in a?at(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var T=(a,e,t)=>nt(a,typeof e!="symbol"?e+"":e,t);import{aw as Ve,j as Ye,l as A,m as Ge,ax as it,ay as P,k as W,T as qe,u as I,s as Q,ab as ce,X as Re,W as Se,az as Ae,r as F,p as Y,ap as st,x as rt,q as te,_ as lt,Z as ot,i as ut,a9 as Qe,H as ct,n as Te,t as ae,a5 as dt,aA as G,e as Ce,aB as be,aC as ye,aD as ht,aE as wt,a8 as gt,aF as _t,ar as bt,aG as je,Y as yt,aH as ft,a3 as pt,aI as vt,aJ as mt,h as Oe,aK as Et,ad as Dt}from"./utils.Dv3gV-s9.js";import{w as Le,g as ne}from"./index.DD94zoj9.js";import{A as D,E as R,g as Rt,e as k,a as M}from"./modalStore.BHz7SopB.js";const ie=0,U=1,se=2;function Zt(a,e,t,n,s){A&&Ge();var r=a,l=Ve(),d=rt,w,g,h,v,u=(l?Q:ce)(void 0),y=(l?Q:ce)(void 0),o=!1;function m(b,f){o=!0,f&&(Re(p),Se(p),Ae(d)),b===ie&&t&&(g?F(g):g=W(()=>t(r))),b===U&&n&&(h?F(h):h=W(()=>n(r,u))),b===se&&s&&(v?F(v):v=W(()=>s(r,y))),b!==ie&&g&&Y(g,()=>g=null),b!==U&&h&&Y(h,()=>h=null),b!==se&&v&&Y(v,()=>v=null),f&&(Ae(null),Se(null),Re(null),st())}var p=Ye(()=>{if(w!==(w=e())){if(it(w)){var b=w;o=!1,b.then(f=>{b===w&&(P(u,f),m(U,!0))},f=>{if(b===w&&(P(y,f),m(se,!0),!s))throw y.v}),A?t&&(g=W(()=>t(r))):qe(()=>{o||m(ie,!0)})}else P(u,w),m(U,!1);return()=>w=null}});A&&(r=I)}let re=null;function Jt(a,e){return e}function St(a,e,t,n){for(var s=[],r=e.length,l=0;l<r;l++)wt(e[l].e,s,!0);var d=r>0&&s.length===0&&t!==null;if(d){var w=t.parentNode;gt(w),w.append(t),n.clear(),O(a,e[0].prev,e[r-1].next)}_t(s,()=>{for(var g=0;g<r;g++){var h=e[g];d||(n.delete(h.k),O(a,h.prev,h.next)),bt(h.e,!d)}})}function Xt(a,e,t,n,s,r=null){var l=a,d={flags:e,items:new Map,first:null},w=(e&je)!==0;if(w){var g=a;l=A?te(lt(g)):g.appendChild(ot())}A&&Ge();var h=null,v=!1;Ye(()=>{var u=t(),y=ut(u)?u:u==null?[]:Qe(u),o=y.length;if(v&&o===0)return;v=o===0;let m=!1;if(A){var p=l.data===ct;p!==(o===0)&&(l=Te(),te(l),ae(!1),m=!0)}if(A){for(var b=null,f,E=0;E<o;E++){if(I.nodeType===8&&I.data===dt){l=I,m=!0,ae(!1);break}var c=y[E],_=n(c,E);f=Be(I,d,b,null,c,_,E,s,e),d.items.set(_,f),b=f}o>0&&te(Te())}if(!A){var J=yt;At(y,d,l,s,e,(J.f&G)!==0,n)}r!==null&&(o===0?h?F(h):h=W(()=>r(l)):h!==null&&Y(h,()=>{h=null})),m&&ae(!0),t()}),A&&(l=I)}function At(a,e,t,n,s,r,l){var pe,ve,me,Ee;var d=(s&ft)!==0,w=(s&(be|ye))!==0,g=a.length,h=e.items,v=e.first,u=v,y,o=null,m,p=[],b=[],f,E,c,_;if(d)for(_=0;_<g;_+=1)f=a[_],E=l(f,_),c=h.get(E),c!==void 0&&((pe=c.a)==null||pe.measure(),(m??(m=new Set)).add(c));for(_=0;_<g;_+=1){if(f=a[_],E=l(f,_),c=h.get(E),c===void 0){var J=u?u.e.nodes_start:t;o=Be(J,e,o,o===null?e.first:o.next,f,E,_,n,s),h.set(E,o),p=[],b=[],u=o.next;continue}if(w&&Tt(c,f,_,s),c.e.f&G&&(F(c.e),d&&((ve=c.a)==null||ve.unfix(),(m??(m=new Set)).delete(c))),c!==u){if(y!==void 0&&y.has(c)){if(p.length<b.length){var H=b[0],C;o=H.prev;var fe=p[0],X=p[p.length-1];for(C=0;C<p.length;C+=1)Ne(p[C],H,t);for(C=0;C<b.length;C+=1)y.delete(b[C]);O(e,fe.prev,X.next),O(e,o,fe),O(e,X,H),u=H,o=X,_-=1,p=[],b=[]}else y.delete(c),Ne(c,u,t),O(e,c.prev,c.next),O(e,c,o===null?e.first:o.next),O(e,o,c),o=c;continue}for(p=[],b=[];u!==null&&u.k!==E;)(r||!(u.e.f&G))&&(y??(y=new Set)).add(u),b.push(u),u=u.next;if(u===null)continue;c=u}p.push(c),o=c,u=c.next}if(u!==null||y!==void 0){for(var $=y===void 0?[]:Qe(y);u!==null;)(r||!(u.e.f&G))&&$.push(u),u=u.next;var ee=$.length;if(ee>0){var tt=s&je&&g===0?t:null;if(d){for(_=0;_<ee;_+=1)(me=$[_].a)==null||me.measure();for(_=0;_<ee;_+=1)(Ee=$[_].a)==null||Ee.fix()}St(e,$,tt,h)}}d&&qe(()=>{var De;if(m!==void 0)for(c of m)(De=c.a)==null||De.apply()}),Ce.first=e.first&&e.first.e,Ce.last=o&&o.e}function Tt(a,e,t,n){n&be&&P(a.v,e),n&ye?P(a.i,t):a.i=t}function Be(a,e,t,n,s,r,l,d,w){var g=re;try{var h=(w&be)!==0,v=(w&ht)===0,u=h?v?ce(s):Q(s):s,y=w&ye?Q(l):l,o={i:y,v:u,k:r,a:null,e:null,prev:t,next:n};return re=o,o.e=W(()=>d(a,u,y),A),o.e.prev=t&&t.e,o.e.next=n&&n.e,t===null?e.first=o:(t.next=o,t.e.next=o.e),n!==null&&(n.prev=o,n.e.prev=o.e),o}finally{re=g}}function Ne(a,e,t){for(var n=a.next?a.next.e.nodes_start:t,s=e?e.e.nodes_start:t,r=a.e.nodes_start;r!==n;){var l=pt(r);s.before(r),r=l}}function O(a,e,t){e===null?a.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}let Ie=!1;function Ke(){Ie||(Ie=!0,document.addEventListener("reset",a=>{Promise.resolve().then(()=>{var e;if(!a.defaultPrevented)for(const t of a.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function ea(a){if(A){var e=!1,t=()=>{if(!e){if(e=!0,a.hasAttribute("value")){var n=a.value;Me(a,"value",null),a.value=n}if(a.hasAttribute("checked")){var s=a.checked;Me(a,"checked",null),a.checked=s}}};a.__on_r=t,vt(t),Ke()}}function Me(a,e,t,n){var s=a.__attributes??(a.__attributes={});A&&(s[e]=a.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&a.nodeName==="LINK")||s[e]!==(s[e]=t)&&(e==="style"&&"__styles"in a&&(a.__styles={}),e==="loading"&&(a[mt]=t),t==null?a.removeAttribute(e):typeof t!="string"&&Ct(a).includes(e)?a[e]=t:a.setAttribute(e,t))}var We=new Map;function Ct(a){var e=We.get(a.nodeName);if(e)return e;We.set(a.nodeName,e=[]);for(var t,n=Oe(a),s=Element.prototype;s!==n;){t=Et(n);for(var r in t)t[r].set&&e.push(r);n=Oe(n)}return e}function Ot(a,e,t,n=t){a.addEventListener(e,t);const s=a.__on_r;s?a.__on_r=()=>{s(),n()}:a.__on_r=n,Ke()}function ta(a,e,t=e){var n=Ve();Ot(a,"input",()=>{var s=ke(a)?xe(a.value):a.value;t(s),n&&s!==(s=e())&&(a.value=s??"")}),Dt(()=>{var s=e();if(A&&a.defaultValue!==a.value){t(a.value);return}ke(a)&&s===xe(a.value)||a.type==="date"&&!s&&!a.value||s!==a.value&&(a.value=s??"")})}function ke(a){var e=a.type;return e==="number"||e==="range"}function xe(a){return a===""?null:+a}function Lt(a,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?a!==e||!n:!e.has(a))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(a):n?n.value:e.get(a)}function Nt(a,e,t,n,s){if(typeof e=="function"?a!==e||!s:!e.has(a))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(a,t),t}var q;function It(a,e=!1){return window.__TAURI_INTERNALS__.transformCallback(a,e)}async function i(a,e={},t){return window.__TAURI_INTERNALS__.invoke(a,e,t)}function aa(a,e="asset"){return window.__TAURI_INTERNALS__.convertFileSrc(a,e)}class Ze{get rid(){return Lt(this,q,"f")}constructor(e){q.set(this,void 0),Nt(this,q,e)}async close(){return i("plugin:resources|close",{rid:this.rid})}}q=new WeakMap;class j{constructor(e){this.path=e}static async load(e){const t=await i("plugin:sql|load",{db:e});return new j(t)}static get(e){return new j(e)}async execute(e,t){const[n,s]=await i("plugin:sql|execute",{db:this.path,query:e,values:t??[]});return{lastInsertId:s,rowsAffected:n}}async select(e,t){return await i("plugin:sql|select",{db:this.path,query:e,values:t??[]})}async close(e){return await i("plugin:sql|close",{db:e})}}var S;(function(a){a.WINDOW_RESIZED="tauri://resize",a.WINDOW_MOVED="tauri://move",a.WINDOW_CLOSE_REQUESTED="tauri://close-requested",a.WINDOW_DESTROYED="tauri://destroyed",a.WINDOW_FOCUS="tauri://focus",a.WINDOW_BLUR="tauri://blur",a.WINDOW_SCALE_FACTOR_CHANGED="tauri://scale-change",a.WINDOW_THEME_CHANGED="tauri://theme-changed",a.WINDOW_CREATED="tauri://window-created",a.WEBVIEW_CREATED="tauri://webview-created",a.DRAG_ENTER="tauri://drag-enter",a.DRAG_OVER="tauri://drag-over",a.DRAG_DROP="tauri://drag-drop",a.DRAG_LEAVE="tauri://drag-leave"})(S||(S={}));async function Je(a,e){await i("plugin:event|unlisten",{event:a,eventId:e})}async function B(a,e,t){var n;const s=typeof(t==null?void 0:t.target)=="string"?{kind:"AnyLabel",label:t.target}:(n=t==null?void 0:t.target)!==null&&n!==void 0?n:{kind:"Any"};return i("plugin:event|listen",{event:a,target:s,handler:It(e)}).then(r=>async()=>Je(a,r))}async function Mt(a,e,t){return B(a,n=>{Je(a,n.id),e(n)},t)}async function Wt(a,e){await i("plugin:event|emit",{event:a,payload:e})}async function kt(a,e,t){await i("plugin:event|emit_to",{target:typeof a=="string"?{kind:"AnyLabel",label:a}:a,event:e,payload:t})}class x extends Ze{constructor(e){super(e)}static async load(e,t){const n=await i("plugin:store|load",{path:e,...t});return new x(n)}static async get(e){return await i("plugin:store|get_store",{path:e}).then(t=>t?new x(t):null)}async set(e,t){await i("plugin:store|set",{rid:this.rid,key:e,value:t})}async get(e){const[t,n]=await i("plugin:store|get",{rid:this.rid,key:e});return n?t:void 0}async has(e){return await i("plugin:store|has",{rid:this.rid,key:e})}async delete(e){return await i("plugin:store|delete",{rid:this.rid,key:e})}async clear(){await i("plugin:store|clear",{rid:this.rid})}async reset(){await i("plugin:store|reset",{rid:this.rid})}async keys(){return await i("plugin:store|keys",{rid:this.rid})}async values(){return await i("plugin:store|values",{rid:this.rid})}async entries(){return await i("plugin:store|entries",{rid:this.rid})}async length(){return await i("plugin:store|length",{rid:this.rid})}async reload(){await i("plugin:store|reload",{rid:this.rid})}async save(){await i("plugin:store|save",{rid:this.rid})}async onKeyChange(e,t){return await B("store://change",n=>{n.payload.resourceId===this.rid&&n.payload.key===e&&t(n.payload.exists?n.payload.value:void 0)})}async onChange(e){return await B("store://change",t=>{t.payload.resourceId===this.rid&&e(t.payload.key,t.payload.exists?t.payload.value:void 0)})}}const L=class L{constructor(){T(this,"database",null);T(this,"lastAccessTime",0);T(this,"IDLE_TIMEOUT",3e4);T(this,"cleanupTimer",null);this.setupCleanupTimer(),window.addEventListener("beforeunload",async()=>{await(await this.getDb()).close()})}setupCleanupTimer(){this.cleanupTimer=setInterval(async()=>{this.database&&Date.now()-this.lastAccessTime>this.IDLE_TIMEOUT&&(console.log("已清理空闲连接"),await this.cleanup(),console.log(this.database))},1e4)}async cleanup(){if(this.database)try{await this.database.close()}catch(e){console.error("Error closing database:",e)}finally{this.database=null}}static getInstance(){return L.instance||(L.instance=new L),L.instance}async getDb(){try{if(!this.database){const t=await(await x.load("settings.json")).get("remote_source");if(!(t!=null&&t.trim()))throw new Error("未设置远程数据源");const n=`sqlite:${t}\\data\\data.db?mode=ro&immutable=1&cache=private`;this.database=await j.load(n)}return this.lastAccessTime=Date.now(),this.database}catch(e){throw console.error(e),new D(R.DB_CONNECTION_ERROR,"数据库连接失败",String(e))}}async getReservationsByDate(e){return await(await this.getDb()).select("SELECT * FROM reservations WHERE reservation_date = $1",[e])}async getReservationsByMonth(e){const t=await this.getDb();console.log(t);const n=`${e}-01`,[s,r]=e.split("-"),l=new Date(Number(s),Number(r),0).getDate(),d=`${s}-${e}-${l}`;return console.log(`SELECT * FROM reservations WHERE reservation_date>='${n}' AND reservation_date<='${d}'`),await t.select(`SELECT * FROM reservations WHERE reservation_date>='${n}' AND reservation_date<='${d}' order by reservation_date desc`)}async getReservationsByYear(e){return await(await this.getDb()).select(`SELECT * FROM reservations WHERE reservation_date>='${e}-01-01' AND reservation_date<='${e}-12-31' order by reservation_date desc`)}async getAllReservations(e){const t=await this.getDb();switch(e){case"month":return await this.getReservationsByMonth(`${new Date().getFullYear()}-${(new Date().getMonth()+1).toString().padStart(2,"0")}`);case"year":return await this.getReservationsByYear(new Date().getFullYear().toString());case"all":return await t.select("SELECT * FROM reservations order by reservation_date desc");default:return[]}}async getReservationsByStationAndTime(e,t,n){return await(await this.getDb()).select('SELECT * FROM reservations WHERE reservation_date=$1 AND station_id=$2 AND time_slot=$3 And RESERVATION_STATUS="normal"',[e,t,n])}async getReservationsByStationAndMonth(e,t){const n=await this.getDb(),s=`${e}-01`,[r,l]=e.split("-"),d=new Date(Number(r),Number(l),0).getDate(),w=`${r}-${e}-${d}`;return await n.select(`SELECT * FROM reservations WHERE station_id=$1 AND reservation_date>='${s}' AND reservation_date<='${w}' And RESERVATION_STATUS="normal"`,[t])}async getAllStations(){const e=await this.getDb();try{const t=await e.select("SELECT * FROM stations order by created_on desc");return console.log(t),Promise.resolve(t)}catch(t){throw new D(R.DB_QUERY_ERROR,"查询工位列表失败",String(t))}}async getStationShortNameById(e){var n;const t=await this.getDb();try{return((n=(await t.select("SELECT short_name FROM stations WHERE id=$1",[e]))[0])==null?void 0:n.short_name)||""}catch(s){throw new D(R.DB_QUERY_ERROR,"查询工位名称失败",String(s))}}async getStationById(e){const t=await this.getDb();try{return await t.select("SELECT * FROM stations WHERE id=$1",[e])}catch(n){throw new D(R.DB_QUERY_ERROR,"查询工位失败",String(n))}}async getAllSevents(){const e=await this.getDb();try{return await e.select("SELECT * FROM s_events order by created_on desc")}catch(t){throw new D(R.DB_QUERY_ERROR,"查询工位事件列表失败",String(t))}}async getSeventsByStationId(e){const t=await this.getDb();try{return await t.select("SELECT * FROM s_events WHERE station_id=$1 order by created_on desc",[e])}catch(n){throw new D(R.DB_QUERY_ERROR,"查询工位事件列表失败",String(n))}}async getAllVistings(e){const t=await this.getDb();try{switch(e){case"month":return await this.getVistingsByMonth(`${new Date().getFullYear()}-${(new Date().getMonth()+1).toString().padStart(2,"0")}`);case"year":return await this.getVistingsByYear(new Date().getFullYear().toString());case"all":return await t.select("SELECT * FROM visitings order by last_visit_time desc");default:return[]}}catch(n){throw new D(R.DB_QUERY_ERROR,"查询访客列表失败",String(n))}}async getVistingsByMonth(e){const t=await this.getDb();try{return await t.select(`SELECT * FROM visitings WHERE last_visit_time>='${e}-01' AND last_visit_time<='${e}-31'`)}catch(n){throw new D(R.DB_QUERY_ERROR,"查询访客列表失败",String(n))}}async getVistingsByYear(e){const t=await this.getDb();try{return await t.select(`SELECT * FROM visitings WHERE last_visit_time>='${e}-01-01' AND last_visit_time<='${e}-12-31'`)}catch(n){throw new D(R.DB_QUERY_ERROR,"查询访客列表失败",String(n))}}async createVisting(e){const t=await this.getDb();try{return await t.execute("INSERT INTO visitings(visit_user,visit_machine,visit_count) VALUES($1,$2,$3)",[e.visit_user,e.visit_machine,e.visit_count])}catch(n){throw new D(R.DB_TRANSACTION_ERROR,"创建访客记录失败",String(n))}}async getVistingByUserAndMachine(e,t){const n=await this.getDb();try{return await n.select("SELECT * FROM visitings WHERE visit_user=$1 AND visit_machine=$2",[e,t])}catch(s){throw new D(R.DB_QUERY_ERROR,"查询访客记录失败",String(s))}}async updateVisting(e){const t=await this.getDb();try{return await t.execute("UPDATE visitings SET visit_count=$1 WHERE id=$2",[e.visit_count,e.id])}catch(n){throw new D(R.DB_TRANSACTION_ERROR,"更新访客记录失败",String(n))}}async deleteVisiting(e){const t=await this.getDb();try{return await t.execute("DELETE FROM visitings WHERE id=$1",[e])}catch(n){throw new D(R.DB_TRANSACTION_ERROR,"删除访客记录失败",String(n))}}async checkDb(){const e=await this.getDb();try{return await e.select("SELECT 1"),!0}catch(t){return console.log(t),!1}}async closeDatabase(){await(await this.getDb()).close()}};T(L,"instance");let de=L;const xt=de.getInstance(),N=class N{constructor(){T(this,"currentMonth");T(this,"selectedDate");const e=new Date().toISOString().split("T")[0];this.currentMonth=Le(new Date().toISOString().split("-").slice(0,2).join("-")),this.selectedDate=Le(e)}static getInstance(){return N.instance||(N.instance=new N),N.instance}changeMonth(e){const[t,n]=ne(this.currentMonth).split("-").map(Number),s=new Date(t,n-1+e,1),r=`${s.getFullYear()}-${(s.getMonth()+1).toString().padStart(2,"0")}`;this.currentMonth.set(r),this.selectedDate.set(`${r}-01`)}getDaysInMonth(e){const[t,n]=e.split("-").map(Number);return new Date(t,n,0).getDate()}getFirstDayOfMonth(e){const[t,n]=e.split("-").map(Number);return new Date(t,n-1,1).getDay()}getCalendarDays(e){const t=this.getDaysInMonth(e);return Array.from({length:t},(n,s)=>s+1)}getDayReservations(e,t){return(t==null?void 0:t.filter(n=>n.reservation_date===e))??[]}getDayColor(e,t){const n=this.getDayReservations(e,t).length,s=Rt("loadSetting");return n===0?"transparent":n<=s.low_load?`rgba(75, 192, 92, 0.${n*2})`:n<=s.medium_load?`rgba(255, 205, 86, 0.${n*2})`:n<=s.high_load?`rgba(255, 153, 0, 0.${n*2})`:"rgba(255, 99, 132, 0.8)"}getDayReservationCount(e,t){return this.getDayReservations(e,t).length}formatDate(e,t){return`${e}-${t.toString().padStart(2,"0")}`}getMonthDisplay(e){const[t,n]=e.split("-").map(Number);return new Date(t,n-1).toLocaleString("zh-CN",{year:"numeric",month:"long"})}setDate(e){this.selectedDate.set(e);const t=e.substring(0,7);t!==ne(this.currentMonth)&&this.currentMonth.set(t)}change(e){const t=new Date(ne(this.selectedDate));t.setDate(t.getDate()+e);const n=t.toISOString().split("T")[0];this.setDate(n)}previous(){this.change(-1)}next(){this.change(1)}getPreviousMonthDays(e){const[t,n]=e.split("-").map(Number),s=new Date(t,n-1,1).getDay();if(s===0)return[];const r=n-1,l=r===0?t-1:t,d=new Date(l,r===0?12:r,0).getDate(),w=[];for(let g=d-s+1;g<=d;g++)w.push(g);return w}isToday(e){const t=new Date,[n,s,r]=e.split("-").map(Number);return t.getFullYear()===n&&t.getMonth()+1===s&&t.getDate()===r}getNextMonthDays(e){const[t,n]=e.split("-").map(Number),s=new Date(t,n,0).getDate(),r=new Date(t,n-1,s).getDay();if(r===6)return[];const l=[];for(let d=1;d<=6-r;d++)l.push(d);return l}};T(N,"instance");let he=N;const na=he.getInstance();var $e;(function(a){a[a.Audio=1]="Audio",a[a.Cache=2]="Cache",a[a.Config=3]="Config",a[a.Data=4]="Data",a[a.LocalData=5]="LocalData",a[a.Document=6]="Document",a[a.Download=7]="Download",a[a.Picture=8]="Picture",a[a.Public=9]="Public",a[a.Video=10]="Video",a[a.Resource=11]="Resource",a[a.Temp=12]="Temp",a[a.AppConfig=13]="AppConfig",a[a.AppData=14]="AppData",a[a.AppLocalData=15]="AppLocalData",a[a.AppCache=16]="AppCache",a[a.AppLog=17]="AppLog",a[a.Desktop=18]="Desktop",a[a.Executable=19]="Executable",a[a.Font=20]="Font",a[a.Home=21]="Home",a[a.Runtime=22]="Runtime",a[a.Template=23]="Template"})($e||($e={}));var Pe;(function(a){a[a.Start=0]="Start",a[a.Current=1]="Current",a[a.End=2]="End"})(Pe||(Pe={}));async function $t(a,e){if(a instanceof URL&&a.protocol!=="file:")throw new TypeError("Must be a file URL.");return await i("plugin:fs|read_text_file",{path:a instanceof URL?a.toString():a,options:e})}async function Xe(a,e){if(a instanceof URL&&a.protocol!=="file:")throw new TypeError("Must be a file URL.");return await i("plugin:fs|exists",{path:a instanceof URL?a.toString():a,options:e})}async function Pt(a={}){return typeof a=="object"&&Object.freeze(a),await i("plugin:dialog|open",{options:a})}async function le(a,e){var n,s;const t=e;await i("plugin:dialog|message",{message:a.toString(),title:(n=t==null?void 0:t.title)==null?void 0:n.toString(),kind:t==null?void 0:t.kind,okButtonLabel:(s=t==null?void 0:t.okLabel)==null?void 0:s.toString()})}async function Ft(a,e){var n,s,r;const t=typeof e=="string"?{title:e}:e;return await i("plugin:dialog|confirm",{message:a.toString(),title:(n=t==null?void 0:t.title)==null?void 0:n.toString(),kind:t==null?void 0:t.kind,okButtonLabel:(s=t==null?void 0:t.okLabel)==null?void 0:s.toString(),cancelButtonLabel:(r=t==null?void 0:t.cancelLabel)==null?void 0:r.toString()})}class zt{constructor(e,t){this.type="Logical",this.width=e,this.height=t}toPhysical(e){return new K(this.width*e,this.height*e)}}class K{constructor(e,t){this.type="Physical",this.width=e,this.height=t}toLogical(e){return new zt(this.width/e,this.height/e)}}class Ht{constructor(e,t){this.type="Logical",this.x=e,this.y=t}toPhysical(e){return new Z(this.x*e,this.x*e)}}class Z{constructor(e,t){this.type="Physical",this.x=e,this.y=t}toLogical(e){return new Ht(this.x/e,this.y/e)}}class z extends Ze{constructor(e){super(e)}static async new(e,t,n){return i("plugin:image|new",{rgba:we(e),width:t,height:n}).then(s=>new z(s))}static async fromBytes(e){return i("plugin:image|from_bytes",{bytes:we(e)}).then(t=>new z(t))}static async fromPath(e){return i("plugin:image|from_path",{path:e}).then(t=>new z(t))}async rgba(){return i("plugin:image|rgba",{rid:this.rid}).then(e=>new Uint8Array(e))}async size(){return i("plugin:image|size",{rid:this.rid})}}function we(a){return a==null?null:typeof a=="string"?a:a instanceof z?a.rid:a}var ge;(function(a){a[a.Critical=1]="Critical",a[a.Informational=2]="Informational"})(ge||(ge={}));class Ut{constructor(e){this._preventDefault=!1,this.event=e.event,this.id=e.id}preventDefault(){this._preventDefault=!0}isPreventDefault(){return this._preventDefault}}var Fe;(function(a){a.None="none",a.Normal="normal",a.Indeterminate="indeterminate",a.Paused="paused",a.Error="error"})(Fe||(Fe={}));function _e(){return new et(window.__TAURI_INTERNALS__.metadata.currentWindow.label,{skip:!0})}async function oe(){return i("plugin:window|get_all_windows").then(a=>a.map(e=>new et(e,{skip:!0})))}const ue=["tauri://created","tauri://error"];class et{constructor(e,t={}){var n;this.label=e,this.listeners=Object.create(null),t!=null&&t.skip||i("plugin:window|create",{options:{...t,parent:typeof t.parent=="string"?t.parent:(n=t.parent)===null||n===void 0?void 0:n.label,label:e}}).then(async()=>this.emit("tauri://created")).catch(async s=>this.emit("tauri://error",s))}static async getByLabel(e){var t;return(t=(await oe()).find(n=>n.label===e))!==null&&t!==void 0?t:null}static getCurrent(){return _e()}static async getAll(){return oe()}static async getFocusedWindow(){for(const e of await oe())if(await e.isFocused())return e;return null}async listen(e,t){return this._handleTauriEvent(e,t)?()=>{const n=this.listeners[e];n.splice(n.indexOf(t),1)}:B(e,t,{target:{kind:"Window",label:this.label}})}async once(e,t){return this._handleTauriEvent(e,t)?()=>{const n=this.listeners[e];n.splice(n.indexOf(t),1)}:Mt(e,t,{target:{kind:"Window",label:this.label}})}async emit(e,t){if(ue.includes(e)){for(const n of this.listeners[e]||[])n({event:e,id:-1,payload:t});return}return Wt(e,t)}async emitTo(e,t,n){if(ue.includes(t)){for(const s of this.listeners[t]||[])s({event:t,id:-1,payload:n});return}return kt(e,t,n)}_handleTauriEvent(e,t){return ue.includes(e)?(e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t],!0):!1}async scaleFactor(){return i("plugin:window|scale_factor",{label:this.label})}async innerPosition(){return i("plugin:window|inner_position",{label:this.label}).then(({x:e,y:t})=>new Z(e,t))}async outerPosition(){return i("plugin:window|outer_position",{label:this.label}).then(({x:e,y:t})=>new Z(e,t))}async innerSize(){return i("plugin:window|inner_size",{label:this.label}).then(({width:e,height:t})=>new K(e,t))}async outerSize(){return i("plugin:window|outer_size",{label:this.label}).then(({width:e,height:t})=>new K(e,t))}async isFullscreen(){return i("plugin:window|is_fullscreen",{label:this.label})}async isMinimized(){return i("plugin:window|is_minimized",{label:this.label})}async isMaximized(){return i("plugin:window|is_maximized",{label:this.label})}async isFocused(){return i("plugin:window|is_focused",{label:this.label})}async isDecorated(){return i("plugin:window|is_decorated",{label:this.label})}async isResizable(){return i("plugin:window|is_resizable",{label:this.label})}async isMaximizable(){return i("plugin:window|is_maximizable",{label:this.label})}async isMinimizable(){return i("plugin:window|is_minimizable",{label:this.label})}async isClosable(){return i("plugin:window|is_closable",{label:this.label})}async isVisible(){return i("plugin:window|is_visible",{label:this.label})}async title(){return i("plugin:window|title",{label:this.label})}async theme(){return i("plugin:window|theme",{label:this.label})}async center(){return i("plugin:window|center",{label:this.label})}async requestUserAttention(e){let t=null;return e&&(e===ge.Critical?t={type:"Critical"}:t={type:"Informational"}),i("plugin:window|request_user_attention",{label:this.label,value:t})}async setResizable(e){return i("plugin:window|set_resizable",{label:this.label,value:e})}async setEnabled(e){return i("plugin:window|set_enabled",{label:this.label,value:e})}async isEnabled(){return i("plugin:window|is_enabled",{label:this.label})}async setMaximizable(e){return i("plugin:window|set_maximizable",{label:this.label,value:e})}async setMinimizable(e){return i("plugin:window|set_minimizable",{label:this.label,value:e})}async setClosable(e){return i("plugin:window|set_closable",{label:this.label,value:e})}async setTitle(e){return i("plugin:window|set_title",{label:this.label,value:e})}async maximize(){return i("plugin:window|maximize",{label:this.label})}async unmaximize(){return i("plugin:window|unmaximize",{label:this.label})}async toggleMaximize(){return i("plugin:window|toggle_maximize",{label:this.label})}async minimize(){return i("plugin:window|minimize",{label:this.label})}async unminimize(){return i("plugin:window|unminimize",{label:this.label})}async show(){return i("plugin:window|show",{label:this.label})}async hide(){return i("plugin:window|hide",{label:this.label})}async close(){return i("plugin:window|close",{label:this.label})}async destroy(){return i("plugin:window|destroy",{label:this.label})}async setDecorations(e){return i("plugin:window|set_decorations",{label:this.label,value:e})}async setShadow(e){return i("plugin:window|set_shadow",{label:this.label,value:e})}async setEffects(e){return i("plugin:window|set_effects",{label:this.label,value:e})}async clearEffects(){return i("plugin:window|set_effects",{label:this.label,value:null})}async setAlwaysOnTop(e){return i("plugin:window|set_always_on_top",{label:this.label,value:e})}async setAlwaysOnBottom(e){return i("plugin:window|set_always_on_bottom",{label:this.label,value:e})}async setContentProtected(e){return i("plugin:window|set_content_protected",{label:this.label,value:e})}async setSize(e){if(!e||e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");const t={};return t[`${e.type}`]={width:e.width,height:e.height},i("plugin:window|set_size",{label:this.label,value:t})}async setMinSize(e){if(e&&e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");let t=null;return e&&(t={},t[`${e.type}`]={width:e.width,height:e.height}),i("plugin:window|set_min_size",{label:this.label,value:t})}async setMaxSize(e){if(e&&e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `size` argument must be either a LogicalSize or a PhysicalSize instance");let t=null;return e&&(t={},t[`${e.type}`]={width:e.width,height:e.height}),i("plugin:window|set_max_size",{label:this.label,value:t})}async setSizeConstraints(e){function t(n){return n?{Logical:n}:null}return i("plugin:window|set_size_constraints",{label:this.label,value:{minWidth:t(e==null?void 0:e.minWidth),minHeight:t(e==null?void 0:e.minHeight),maxWidth:t(e==null?void 0:e.maxWidth),maxHeight:t(e==null?void 0:e.maxHeight)}})}async setPosition(e){if(!e||e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `position` argument must be either a LogicalPosition or a PhysicalPosition instance");const t={};return t[`${e.type}`]={x:e.x,y:e.y},i("plugin:window|set_position",{label:this.label,value:t})}async setFullscreen(e){return i("plugin:window|set_fullscreen",{label:this.label,value:e})}async setFocus(){return i("plugin:window|set_focus",{label:this.label})}async setIcon(e){return i("plugin:window|set_icon",{label:this.label,value:we(e)})}async setSkipTaskbar(e){return i("plugin:window|set_skip_taskbar",{label:this.label,value:e})}async setCursorGrab(e){return i("plugin:window|set_cursor_grab",{label:this.label,value:e})}async setCursorVisible(e){return i("plugin:window|set_cursor_visible",{label:this.label,value:e})}async setCursorIcon(e){return i("plugin:window|set_cursor_icon",{label:this.label,value:e})}async setCursorPosition(e){if(!e||e.type!=="Logical"&&e.type!=="Physical")throw new Error("the `position` argument must be either a LogicalPosition or a PhysicalPosition instance");const t={};return t[`${e.type}`]={x:e.x,y:e.y},i("plugin:window|set_cursor_position",{label:this.label,value:t})}async setIgnoreCursorEvents(e){return i("plugin:window|set_ignore_cursor_events",{label:this.label,value:e})}async startDragging(){return i("plugin:window|start_dragging",{label:this.label})}async startResizeDragging(e){return i("plugin:window|start_resize_dragging",{label:this.label,value:e})}async setProgressBar(e){return i("plugin:window|set_progress_bar",{label:this.label,value:e})}async setVisibleOnAllWorkspaces(e){return i("plugin:window|set_visible_on_all_workspaces",{label:this.label,value:e})}async setTitleBarStyle(e){return i("plugin:window|set_title_bar_style",{label:this.label,value:e})}async setTheme(e){return i("plugin:window|set_theme",{label:this.label,value:e})}async onResized(e){return this.listen(S.WINDOW_RESIZED,t=>{t.payload=Vt(t.payload),e(t)})}async onMoved(e){return this.listen(S.WINDOW_MOVED,t=>{t.payload=V(t.payload),e(t)})}async onCloseRequested(e){return this.listen(S.WINDOW_CLOSE_REQUESTED,async t=>{const n=new Ut(t);await e(n),n.isPreventDefault()||await this.destroy()})}async onDragDropEvent(e){const t=await this.listen(S.DRAG_ENTER,l=>{e({...l,payload:{type:"enter",paths:l.payload.paths,position:V(l.payload.position)}})}),n=await this.listen(S.DRAG_OVER,l=>{e({...l,payload:{type:"over",position:V(l.payload.position)}})}),s=await this.listen(S.DRAG_DROP,l=>{e({...l,payload:{type:"drop",paths:l.payload.paths,position:V(l.payload.position)}})}),r=await this.listen(S.DRAG_LEAVE,l=>{e({...l,payload:{type:"leave"}})});return()=>{t(),s(),n(),r()}}async onFocusChanged(e){const t=await this.listen(S.WINDOW_FOCUS,s=>{e({...s,payload:!0})}),n=await this.listen(S.WINDOW_BLUR,s=>{e({...s,payload:!1})});return()=>{t(),n()}}async onScaleChanged(e){return this.listen(S.WINDOW_SCALE_FACTOR_CHANGED,e)}async onThemeChanged(e){return this.listen(S.WINDOW_THEME_CHANGED,e)}}var ze;(function(a){a.AppearanceBased="appearanceBased",a.Light="light",a.Dark="dark",a.MediumLight="mediumLight",a.UltraDark="ultraDark",a.Titlebar="titlebar",a.Selection="selection",a.Menu="menu",a.Popover="popover",a.Sidebar="sidebar",a.HeaderView="headerView",a.Sheet="sheet",a.WindowBackground="windowBackground",a.HudWindow="hudWindow",a.FullScreenUI="fullScreenUI",a.Tooltip="tooltip",a.ContentBackground="contentBackground",a.UnderWindowBackground="underWindowBackground",a.UnderPageBackground="underPageBackground",a.Mica="mica",a.Blur="blur",a.Acrylic="acrylic",a.Tabbed="tabbed",a.TabbedDark="tabbedDark",a.TabbedLight="tabbedLight"})(ze||(ze={}));var He;(function(a){a.FollowsWindowActiveState="followsWindowActiveState",a.Active="active",a.Inactive="inactive"})(He||(He={}));function V(a){return new Z(a.x,a.y)}function Vt(a){return new K(a.width,a.height)}const Yt=async a=>{if(await Xe(`${a}\\data\\data.db`)){const t=await xt.checkDb();return console.log(t),t?!0:(k.showError("数据库格式错误，无法使用"),!1)}else return k.showError("数据库文件不存在"),!1},Gt=async a=>await Xe(`${a}\\settings.json`)?!!await qt(a):(k.showError("远程设置文件不存在"),!1),qt=async a=>{try{const e=await $t(`${a}\\settings.json`),t=JSON.parse(e);return console.log(t),t.tests&&t.project_engineers&&t.testing_engineers&&t.station_orders?(M("tests",t.tests),M("project_engineers",t.project_engineers),M("testing_engineers",t.testing_engineers),M("loadSetting",t.loadSetting),M("station_orders",t.station_orders),!0):(k.showError("设置文件信息不完整"),!1)}catch(e){return k.showError("初始化设置文件出错："+e),!1}},Ue=async()=>{if(!await Ft(`请检查下面内容：
 1.远程数据源当前不可用，或未设置
 2.你未被授权
 请重新选择远程数据源或退出`,{title:"错误",kind:"warning"})){await le("没有选择远程数据源或者远程数据源暂时不可用,无法使用本软件，软件将退出！"),await(await _e()).close();return}const e=await Pt({title:"远程数据源不可用或未设置，请选择远程数据源或退出",directory:!0});e?(await(await x.load("settings.json")).set("remote_source",e),await le("已设置远程数据源,请重启软件已生效！")):await le("没有选择远程数据源或者远程数据源暂时不可用,无法使用本软件，软件将退出！"),await(await _e()).close()},ia=async()=>{const e=await(await x.load("settings.json")).get("remote_source");if(!e){k.showError("无设置，请设置远程数据源"),await Ue();return}const t=await Yt(e),n=await Gt(e);if(!t||!n){await Ue();return}M("remote_source",e)};export{x as S,Zt as a,ta as b,na as c,xt as d,Xt as e,Jt as f,Xe as g,aa as h,ia as i,le as m,Pt as o,ea as r,Me as s};
