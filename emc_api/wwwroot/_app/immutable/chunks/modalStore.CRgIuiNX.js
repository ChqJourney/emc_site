var E=Object.defineProperty;var T=(t,e,s)=>e in t?E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var h=(t,e,s)=>T(t,typeof e!="symbol"?e+"":e,s);import{l as _}from"./utils.sQOqgOVm.js";import{w as A}from"./index.dAKAKWrd.js";function p(t,e){var s=t.__className,a=m(e);_&&t.className===a?t.__className=a:(s!==a||_&&t.className!==a)&&(e==null?t.removeAttribute("class"):t.className=a,t.__className=a)}function m(t){return t??""}function g(t,e,s){if(s){if(t.classList.contains(e))return;t.classList.add(e)}else{if(!t.classList.contains(e))return;t.classList.remove(e)}}var n=(t=>(t[t.DB_CONNECTION_ERROR=1e3]="DB_CONNECTION_ERROR",t[t.DB_QUERY_ERROR=1001]="DB_QUERY_ERROR",t[t.DB_TRANSACTION_ERROR=1002]="DB_TRANSACTION_ERROR",t[t.RESERVATION_CONFLICT=2e3]="RESERVATION_CONFLICT",t[t.STATION_NOT_AVAILABLE=2001]="STATION_NOT_AVAILABLE",t[t.INVALID_TIME_SLOT=2002]="INVALID_TIME_SLOT",t[t.UNAUTHORIZED_ACCESS=2003]="UNAUTHORIZED_ACCESS",t[t.INVALID_INPUT=3e3]="INVALID_INPUT",t[t.REQUIRED_FIELD_MISSING=3001]="REQUIRED_FIELD_MISSING",t[t.INVALID_DATE_FORMAT=3002]="INVALID_DATE_FORMAT",t[t.INVALID_PHONE_FORMAT=3003]="INVALID_PHONE_FORMAT",t[t.ExportExcelFileError=4001]="ExportExcelFileError",t[t.API_ERROR=4002]="API_ERROR",t[t.API_PARSE_ERROR=4003]="API_PARSE_ERROR",t[t.API_REQUEST_ERROR=4004]="API_REQUEST_ERROR",t[t.UNKNOWN_ERROR=9999]="UNKNOWN_ERROR",t))(n||{});class i extends Error{constructor(e,s,a){super(s),this.code=e,this.message=s,this.details=a,this.name="AppError"}}const u={1e3:"数据库连接失败",1001:"数据库查询错误",1002:"数据库事务错误",2e3:"该时间段已被预约",2001:"工位不可用",2002:"无效的时间段",2003:"未授权的访问",3e3:"输入数据无效",3001:"必填字段缺失",3002:"日期格式无效",3003:"电话号码格式无效",4001:"导出Excel文件时发生错误",9999:"未知错误"},l=A({show:!1,message:"",type:"error"}),c=class c{constructor(){}static getInstance(){return c.instance||(c.instance=new c),c.instance}handleError(e){if(console.error("Error occurred:",e),e instanceof i)switch(this.showError(`${e.message}${e.details?":":""} ${e.details??""}`||u[e.code]),e.code){case n.DB_CONNECTION_ERROR:break;case n.UNAUTHORIZED_ACCESS:break}else this.showError(e.message||u[n.UNKNOWN_ERROR])}showError(e){l.set({show:!0,message:e,type:"error"}),setTimeout(()=>{l.set({show:!1,message:"",type:"error"})},5e3)}showWarning(e){l.set({show:!0,message:e,type:"warning"}),setTimeout(()=>{l.set({show:!1,message:"",type:"error"})},3e3)}showInfo(e){l.set({show:!0,message:e,type:"info"}),setTimeout(()=>{l.set({show:!1,message:"",type:"error"})},3e3)}validatePhone(e){if(!/^1[3-9]\d{9}$/.test(e))throw new i(n.INVALID_PHONE_FORMAT,"请输入有效的手机号码");return!0}validateRequired(e,s){if(e==null||e==="")throw new i(n.REQUIRED_FIELD_MISSING,`${s}不能为空`);return!0}validateDate(e){if(!/^\d{4}-\d{2}-\d{2}$/.test(e))throw new i(n.INVALID_DATE_FORMAT,"日期格式无效，请使用YYYY-MM-DD格式");return!0}};h(c,"instance");let I=c;const U=I.getInstance(),R=class R{constructor(){h(this,"baseUrl","");h(this,"username");h(this,"machineName")}static getInstance(){return R.instance||(R.instance=new R),R.instance}configure(e){this.baseUrl=e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl,this.username=e.username,this.machineName=e.machineName}getAuthHeaders(){const e={"Content-Type":"application/json"};return this.username&&(e.username=this.username),this.machineName&&(e.machinename=this.machineName),e}async handleResponse(e){if(!e.ok){let s;try{s=(await e.json()).message||e.statusText}catch{s=e.statusText}throw new i(n.API_ERROR,`API request failed: ${s}`,{status:e.status})}try{return console.log(e),await e.json()}catch(s){throw new i(n.API_PARSE_ERROR,"Failed to parse API response",{originalError:s})}}async fetch(e,s={}){try{const a=e.startsWith("http")?e:`${this.baseUrl}${e.startsWith("/")?e:`/${e}`}`,r=s.skipAuth?s.headers||{}:{...this.getAuthHeaders(),...s.headers||{}},O=await fetch(a,{...s,headers:r});return await this.handleResponse(O)}catch(a){throw a instanceof i?a:new i(n.API_REQUEST_ERROR,"API request failed",{originalError:a})}}async get(e,s={}){return this.fetch(e,{...s,method:"GET"})}async post(e,s,a={}){return this.fetch(e,{...a,method:"POST",body:JSON.stringify(s)})}async put(e,s,a={}){return this.fetch(e,{...a,method:"PUT",body:JSON.stringify(s)})}async delete(e,s={}){return this.fetch(e,{...s,method:"DELETE"})}};h(R,"instance");let N=R;const o=N.getInstance();o.configure({baseUrl:"http://localhost:5000/api",username:"patri",machineName:"pwin"});function f(){const{subscribe:t,set:e,update:s}=A({show:!1,component:null,props:{}});return{subscribe:t,open:(a,r={})=>{e({show:!0,component:a,props:r})},close:()=>{e({show:!1,component:null,props:{}})}}}const L=f();export{o as a,l as b,U as e,L as m,p as s,g as t};
